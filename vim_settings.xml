<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="/File Header.txt.ft" timestamp="1539141430074">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/DigitalAssertManagerTest.java" timestamp="1539952919922">
        <mark key="[" line="7" column="0" />
        <mark key="]" line="8" column="17" />
        <mark key="^" line="8" column="17" />
        <mark key="." line="8" column="17" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/dao/response/Httpbin_GET_Obj.java" timestamp="1540014817776">
        <mark key="[" line="18" column="0" />
        <mark key="]" line="18" column="39" />
        <mark key="^" line="18" column="13" />
        <mark key="." line="18" column="13" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.yml" timestamp="1540006830921">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="44" column="18" />
        <mark key="^" line="44" column="18" />
        <mark key="." line="44" column="18" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/static/log4j2.yaml" timestamp="1540011549388">
        <mark key="[" line="18" column="22" />
        <mark key="]" line="18" column="22" />
        <mark key="^" line="18" column="22" />
        <mark key="." line="18" column="22" />
      </file>
      <file name="/a.dummy" timestamp="1540054739322">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/Components/SwaggerConfig.java" timestamp="1540064181159">
        <mark key="[" line="25" column="0" />
        <mark key="]" line="25" column="0" />
        <mark key="." line="25" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/Controller/package-info.java" timestamp="1538197762713">
        <mark key="[" line="0" column="43" />
        <mark key="]" line="1" column="13" />
        <mark key="^" line="1" column="13" />
        <mark key="." line="1" column="13" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/ServletInitializer.java" timestamp="1538197771615">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="^" line="11" column="0" />
        <mark key="." line="11" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/rest/HttpbinAPI.java" timestamp="1540007810168">
        <mark key="[" line="13" column="27" />
        <mark key="]" line="17" column="14" />
        <mark key="." line="17" column="14" />
        <mark key="^" line="17" column="14" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" timestamp="1539836230244">
        <mark key="[" line="71" column="42" />
        <mark key="]" line="71" column="40" />
        <mark key="." line="71" column="40" />
        <mark key="^" line="71" column="40" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/DTO/Country.java" timestamp="1540054737254">
        <mark key="[" line="13" column="13" />
        <mark key="]" line="13" column="19" />
        <mark key="." line="13" column="19" />
        <mark key="^" line="13" column="19" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/domaIn/People.java" timestamp="1540062508819">
        <mark key="[" line="17" column="17" />
        <mark key="]" line="19" column="5" />
        <mark key="^" line="19" column="5" />
        <mark key="." line="19" column="5" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/OrderedTests.java" timestamp="1539940859986">
        <mark key="[" line="13" column="36" />
        <mark key="]" line="13" column="43" />
        <mark key="." line="13" column="43" />
        <mark key="^" line="13" column="43" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/DTO/PeopleRepository.java" timestamp="1540056232190">
        <mark key="[" line="17" column="30" />
        <mark key="]" line="17" column="40" />
        <mark key="." line="17" column="40" />
        <mark key="^" line="17" column="40" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.yaml" timestamp="1540013989082">
        <mark key="'" line="37" column="13" />
        <mark key="[" line="42" column="18" />
        <mark key="]" line="42" column="17" />
        <mark key="^" line="42" column="17" />
        <mark key="." line="42" column="17" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/Controller/HttpbinController.java" timestamp="1540063735066">
        <mark key="[" line="70" column="0" />
        <mark key="]" line="70" column="0" />
        <mark key="." line="70" column="0" />
        <mark key="^" line="69" column="6" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/rest/HttpbinAPIService.java" timestamp="1540022877303">
        <mark key="[" line="17" column="0" />
        <mark key="]" line="17" column="0" />
        <mark key="." line="17" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/Tmp.java" timestamp="1539932516249">
        <mark key="[" line="6" column="0" />
        <mark key="]" line="8" column="0" />
        <mark key="." line="8" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/README.md" timestamp="1538196993554">
        <mark key="[" line="6" column="6" />
        <mark key="]" line="6" column="4" />
        <mark key="^" line="6" column="4" />
        <mark key="." line="6" column="4" />
      </file>
      <file name="/ActionScript File Header.txt.ft" timestamp="1539141428189">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/test/java/Guava/BasicUtilitiesTest.java" timestamp="1540201321617">
        <mark key="[" line="19" column="32" />
        <mark key="]" line="30" column="43" />
        <mark key="." line="30" column="43" />
        <mark key="^" line="30" column="43" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/Controller/CustomController.java" timestamp="1540048951728">
        <mark key="[" line="21" column="0" />
        <mark key="]" line="21" column="0" />
        <mark key="." line="21" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/resources/application.properties" timestamp="1539836306954">
        <mark key="[" line="5" column="3" />
        <mark key="]" line="5" column="5" />
        <mark key="^" line="5" column="5" />
        <mark key="." line="5" column="5" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/RetrofitSwaggerApplication.java" timestamp="1540042046706">
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="15" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TmpTest.java" timestamp="1539932746473">
        <mark key="[" line="7" column="44" />
        <mark key="]" line="7" column="29" />
        <mark key="^" line="7" column="29" />
        <mark key="." line="7" column="29" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/AggregatingTests.java" timestamp="1539940782842">
        <mark key="[" line="16" column="25" />
        <mark key="]" line="9" column="25" />
        <mark key="^" line="9" column="25" />
        <mark key="." line="9" column="25" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/Service/AliService.java" timestamp="1540010963106">
        <mark key="[" line="44" column="42" />
        <mark key="]" line="127" column="29" />
        <mark key="." line="127" column="29" />
        <mark key="^" line="127" column="29" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/ExpectedExceptionTests.java" timestamp="1539937062818">
        <mark key="[" line="25" column="0" />
        <mark key="]" line="25" column="0" />
        <mark key="." line="25" column="0" />
        <mark key="^" line="4" column="36" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" timestamp="1540051434713">
        <mark key="[" line="63" column="0" />
        <mark key="]" line="67" column="21" />
        <mark key="^" line="63" column="12" />
        <mark key="." line="63" column="12" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/BasicUtilities/package-info.java" timestamp="1540179466186">
        <mark key="]" line="0" column="62" />
        <mark key="^" line="0" column="62" />
        <mark key="." line="0" column="62" />
      </file>
      <file name="/Arquillian Deployment Method.txt.ft" timestamp="1539141431429">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/pom.xml" timestamp="1540179778757">
        <mark key="[" line="19" column="0" />
        <mark key="]" line="19" column="20" />
        <mark key="^" line="25" column="0" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/pom.xml" timestamp="1539931196144">
        <mark key="[" line="27" column="21" />
        <mark key="]" line="35" column="0" />
        <mark key="^" line="35" column="0" />
        <mark key="." line="35" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/playground/java_novice/pom.xml" timestamp="1539078888145">
        <mark key="[" line="19" column="0" />
        <mark key="]" line="10" column="0" />
        <mark key="." line="10" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/upload.sh" timestamp="1539334385187">
        <mark key="[" line="3" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/JunitDemo/List.java" timestamp="1539947375671">
        <mark key="[" line="8" column="16" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/data.sql" timestamp="1540056291632">
        <mark key="'" line="2" column="17" />
        <mark key="[" line="0" column="45" />
        <mark key="]" line="0" column="46" />
        <mark key="^" line="0" column="46" />
        <mark key="." line="0" column="46" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/src/main/java/AI/Voice/MscVoiceCompose.java" timestamp="1539243624222">
        <mark key="[" line="8" column="0" />
        <mark key="]" line="8" column="0" />
        <mark key="." line="8" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/JunitDemo/Tmp.java" timestamp="1539932962016">
        <mark key="[" line="15" column="61" />
        <mark key="]" line="16" column="50" />
        <mark key="^" line="16" column="50" />
        <mark key="." line="16" column="50" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/pom.xml" timestamp="1540173480138">
        <mark key="'" line="132" column="0" />
        <mark key="[" line="104" column="0" />
        <mark key="]" line="115" column="18" />
        <mark key="^" line="115" column="18" />
        <mark key="." line="115" column="18" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/Example.java" timestamp="1540017935831">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="19" column="0" />
        <mark key="]" line="20" column="0" />
        <mark key="^" line="20" column="0" />
        <mark key="." line="20" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.json" timestamp="1540011982072">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/Caculator.java" timestamp="1539930544707">
        <mark key="[" line="6" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="." line="15" column="0" />
        <mark key="^" line="15" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/resources/log4j2.xml" timestamp="1540011268206">
        <mark key="[" line="21" column="15" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.xml" timestamp="1540011597459">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="25" />
        <mark key="." line="39" column="25" />
        <mark key="^" line="39" column="25" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/src/main/java/com/mrboxfood/lightwork/Service/LightWorkWechatService.java" timestamp="1540023166861">
        <mark key="[" line="131" column="23" />
        <mark key="]" line="131" column="22" />
        <mark key="^" line="131" column="22" />
        <mark key="." line="131" column="22" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/Guava/BasicUtilities.java" timestamp="1540191477956">
        <mark key="[" line="15" column="56" />
        <mark key="]" line="15" column="30" />
        <mark key="^" line="15" column="30" />
        <mark key="." line="15" column="30" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/Controller/UnusedController.java" timestamp="1540062234671">
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/src/main/java/AI/package-info.java" timestamp="1539236314575">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="1" column="6" />
        <mark key="^" line="1" column="6" />
        <mark key="." line="1" column="6" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/src/test/java/AI/Voice/MscVoiceComposeTest.java" timestamp="1539421464967">
        <mark key="[" line="13" column="25" />
        <mark key="]" line="14" column="0" />
        <mark key="." line="14" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/log4jdemo/src/main/resources/log4j2.xml" timestamp="1538198122901">
        <mark key="[" line="22" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/Guava/ArrayBlockingQueue.java" timestamp="1540201480804">
        <mark key="[" line="148" column="9" />
        <mark key="]" line="149" column="19" />
        <mark key="." line="149" column="19" />
        <mark key="^" line="149" column="19" />
      </file>
      <file name="/HTML File.txt.ft" timestamp="1539141557137">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/application.properties" timestamp="1540054649801">
        <mark key="[" line="1" column="35" />
        <mark key="]" line="2" column="28" />
        <mark key="." line="2" column="28" />
        <mark key="^" line="2" column="28" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/src/main/java/AI/Voice/package-info.java" timestamp="1539236343120">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="1" column="12" />
        <mark key="^" line="1" column="12" />
        <mark key="." line="1" column="12" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/test/java/com/zhiri/qu_voice_java/Service/AliServiceTest.java" timestamp="1539919061316">
        <mark key="[" line="19" column="14" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
        <mark key="^" line="3" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1540064191117">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TestFixturesExample.java" timestamp="1539969363022">
        <mark key="[" line="8" column="0" />
        <mark key="]" line="71" column="0" />
        <mark key="." line="71" column="0" />
        <mark key="^" line="71" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j.xml" timestamp="1540010768176">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="21" column="15" />
        <mark key="^" line="21" column="15" />
        <mark key="." line="21" column="15" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/test/java/JavaStandardModuleLearning/JavaFutureTest.java" timestamp="1539090985605">
        <mark key="[" line="14" column="47" />
        <mark key="]" line="14" column="70" />
        <mark key="^" line="14" column="70" />
        <mark key="." line="14" column="70" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/Service/HttpbinService.java" timestamp="1540003452114">
        <mark key="[" line="15" column="19" />
        <mark key="]" line="15" column="18" />
        <mark key="^" line="15" column="18" />
        <mark key="." line="15" column="18" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/rest/SppechInit.java" timestamp="1538207029862">
        <mark key="[" line="17" column="0" />
        <mark key="]" line="17" column="0" />
        <mark key="." line="17" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/src/main/java/com/mrboxfood/lightwork/dto/MyResponse.java" timestamp="1540002339379">
        <mark key="[" line="11" column="4" />
        <mark key="]" line="11" column="4" />
        <mark key="^" line="11" column="4" />
        <mark key="." line="11" column="4" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/src/main/java/com/mrboxfood/MyWebConfig.java" timestamp="1538967235364">
        <mark key="[" line="17" column="56" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/websockets/pom.xml" timestamp="1539773450690">
        <mark key="[" line="20" column="0" />
        <mark key="]" line="20" column="0" />
        <mark key="^" line="28" column="16" />
        <mark key="." line="20" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/Tmp.java" timestamp="1540008658737">
        <mark key="[" line="19" column="15" />
        <mark key="]" line="31" column="16" />
        <mark key="." line="31" column="16" />
        <mark key="^" line="31" column="16" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/SpringfoxExample.java" timestamp="1540041613275">
        <mark key="'" line="133" column="0" />
        <mark key="[" line="34" column="0" />
        <mark key="]" line="34" column="0" />
        <mark key="^" line="133" column="0" />
        <mark key="." line="34" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/static/log4j2.xml" timestamp="1540012441613">
        <mark key="[" line="19" column="6" />
        <mark key="]" line="11" column="15" />
        <mark key="^" line="11" column="15" />
        <mark key="." line="11" column="15" />
      </file>
      <file name="/Class.txt.ft" timestamp="1539141558667">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/schema.sql" timestamp="1540054799532">
        <mark key="[" line="0" column="20" />
        <mark key="]" line="0" column="18" />
        <mark key="^" line="0" column="18" />
        <mark key="." line="0" column="18" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/Guava/package-info.java" timestamp="1540179531840">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="38" />
        <mark key="^" line="0" column="38" />
        <mark key="." line="0" column="38" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/Changelog.md" timestamp="1539056011694">
        <mark key="[" line="10" column="12" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/QuVoiceJavaApplication.java" timestamp="1538222398106">
        <mark key="[" line="9" column="44" />
        <mark key="]" line="11" column="44" />
        <mark key="." line="11" column="44" />
        <mark key="^" line="11" column="44" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/README.md" timestamp="1539972289637">
        <mark key="[" line="2" column="82" />
        <mark key="]" line="8" column="9" />
        <mark key="^" line="8" column="9" />
        <mark key="." line="8" column="9" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/dao/response/Httpbin_GET_Obj2.java" timestamp="1540008799774">
        <mark key="[" line="16" column="29" />
        <mark key="]" line="16" column="3" />
        <mark key="^" line="16" column="3" />
        <mark key="." line="16" column="3" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/CalculatorTest.java" timestamp="1539931407351">
        <mark key="[" line="4" column="0" />
        <mark key="]" line="4" column="0" />
        <mark key="." line="4" column="0" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/AssertTests.java" timestamp="1539940809778">
        <mark key="[" line="3" column="22" />
        <mark key="]" line="3" column="20" />
        <mark key="." line="3" column="20" />
        <mark key="^" line="3" column="20" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/rest/HttpbinRestConfig.java" timestamp="1540008088529">
        <mark key="[" line="23" column="5" />
        <mark key="]" line="22" column="48" />
        <mark key="^" line="22" column="48" />
        <mark key="." line="22" column="48" />
      </file>
      <file name="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/DTO/People.java" timestamp="1540054752920">
        <mark key="[" line="22" column="17" />
        <mark key="]" line="22" column="18" />
        <mark key="^" line="22" column="18" />
        <mark key="." line="22" column="18" />
      </file>
      <file name="/fragment.java" timestamp="1540179744635">
        <mark key="[" line="0" column="0" />
      </file>
    </filemarks>
    <jumps>
      <jump line="5" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/CHANGELOG.md" />
      <jump line="8" column="25" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/MyWebConfig.java" />
      <jump line="14" column="10" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/MyWebConfig.java" />
      <jump line="39" column="36" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="44" column="36" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="15" column="32" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="38" column="41" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="124" column="19" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="15" column="32" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="29" column="36" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="33" column="36" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="37" column="36" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="11" column="15" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/resources/log4j2.xml" />
      <jump line="21" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/resources/log4j2.xml" />
      <jump line="0" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/resources/log4j2.xml" />
      <jump line="19" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/Controller/TestController.java" />
      <jump line="11" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/lib/Msc.jar!/com/iflytek/cloud/speech/SpeechUtility.class" />
      <jump line="44" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/src/main/java/com/zhiri/qu_voice_java/Service/VoiceService.java" />
      <jump line="37" column="39" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="30" column="12" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="82" column="28" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="14" column="21" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="41" column="40" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="126" column="34" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="29" column="25" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="106" column="31" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="63" column="43" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="103" column="13" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="97" column="44" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="95" column="34" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="85" column="20" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="13" column="11" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="16" column="32" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="23" column="32" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="7" column="5" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="35" column="12" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="99" column="24" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="0" column="0" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="5" column="3" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="41" column="29" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="1" column="17" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="48" column="39" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="16" column="0" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="37" column="17" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="59" column="40" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="58" column="26" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="32" column="41" filename="$USER_HOME$/etc/losFiles/projects/playground/java_novice/src/main/java/JavaStandardModuleLearning/JavaFuture.java" />
      <jump line="17" column="6" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/.gitignore" />
      <jump line="5" column="11" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/.gitignore" />
      <jump line="0" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/.gitignore" />
      <jump line="41" column="9" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/.gitignore" />
      <jump line="32" column="15" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/pom.xml" />
      <jump line="15" column="6" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/pom.xml" />
      <jump line="18" column="16" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/pom.xml" />
      <jump line="11" column="26" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="32" column="55" filename="$USER_HOME$/etc/losFiles/projects/AI/qu_voice_java/pom.xml" />
      <jump line="20" column="15" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/src/main/resources/application.properties" />
      <jump line="52" column="0" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/src/main/resources/application.properties" />
      <jump line="1744" column="10" filename="/Library/Java/JavaVirtualMachines/jdk1.8.0_172.jdk/Contents/Home/src.zip!/java/lang/Thread.java" />
      <jump line="104" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/Address.java" />
      <jump line="4" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/AddressTest.java" />
      <jump line="100" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/AddressTest.java" />
      <jump line="101" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/AssertTests.java" />
      <jump line="106" column="1" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/JunitDemo/Assertions.java" />
      <jump line="28" column="4" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/ExpectedExceptionTests.java" />
      <jump line="37" column="4" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TimeoutTests.java" />
      <jump line="16" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TimeoutTests.java" />
      <jump line="31" column="21" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TimeoutTests.java" />
      <jump line="8" column="16" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/Tmp.java" />
      <jump line="46" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/Tmp.java" />
      <jump line="10" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/Tmp.java" />
      <jump line="11" column="22" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/TimeoutTests.java" />
      <jump line="1" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/Tmp.java" />
      <jump line="70" column="13" filename="/Library/Java/JavaVirtualMachines/jdk1.8.0_172.jdk/Contents/Home/src.zip!/java/util/Arrays.java" />
      <jump line="15" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/main/java/JunitDemo/MyList.java" />
      <jump line="63" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/src/test/java/JunitDemo/WatchmanTest.java" />
      <jump line="0" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/junit4/.gitignore" />
      <jump line="4" column="43" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/rest/HttpbinAPI.java" />
      <jump line="28" column="54" filename="$USER_HOME$/etc/losFiles/projects/Java/miniProgram/pom.xml" />
      <jump line="42" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/com/losyear/retrofit_swagger/dao/response/Result.java" />
      <jump line="40" column="16" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.xml" />
      <jump line="29" column="22" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.yaml" />
      <jump line="37" column="13" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/log4j2.yaml" />
      <jump line="40" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/Example.java" />
      <jump line="130" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/java/SpringfoxExample.java" />
      <jump line="99" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/pom.xml" />
      <jump line="2" column="17" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/src/main/resources/data.sql" />
      <jump line="109" column="20" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/pom.xml" />
      <jump line="132" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/retrofit_swagger/pom.xml" />
      <jump line="1451" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/Guava/ArrayBlockingQueue.java" />
      <jump line="406" column="0" filename="$USER_HOME$/etc/losFiles/projects/perfect/demos/guavademo/src/main/java/Guava/ArrayBlockingQueue.java" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">ICAgIGZpbmFsIGludCBkZWMoaW50IGkpIHsKICAgICAgICByZXR1cm4gKChpID09IDApID8gaXRlbXMubGVuZ3RoIDogaSkgLSAxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBpdGVtIGF0IGluZGV4IGkuCiAgICAgKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgZmluYWwgRSBpdGVtQXQoaW50IGkpIHsKICAgICAgICByZXR1cm4gKEUpIGl0ZW1zW2ldOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIGFyZ3VtZW50IGlzIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIHYgdGhlIGVsZW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjaGVja05vdE51bGwoT2JqZWN0IHYpIHsKICAgICAgICBpZiAodiA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydHMgZWxlbWVudCBhdCBjdXJyZW50IHB1dCBwb3NpdGlvbiwgYWR2YW5jZXMsIGFuZCBzaWduYWxzLgogICAgICogQ2FsbCBvbmx5IHdoZW4gaG9sZGluZyBsb2NrLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5xdWV1ZShFIHgpIHsKICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgIC8vIGFzc2VydCBpdGVtc1twdXRJbmRleF0gPT0gbnVsbDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgaXRlbXNbcHV0SW5kZXhdID0geDsKICAgICAgICBpZiAoKytwdXRJbmRleCA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgIHB1dEluZGV4ID0gMDsKICAgICAgICBjb3VudCsrOwogICAgICAgIG5vdEVtcHR5LnNpZ25hbCgpOwogICAgfQoKICAgIC8qKgogICAgICogRXh0cmFjdHMgZWxlbWVudCBhdCBjdXJyZW50IHRha2UgcG9zaXRpb24sIGFkdmFuY2VzLCBhbmQgc2lnbmFscy4KICAgICAqIENhbGwgb25seSB3aGVuIGhvbGRpbmcgbG9jay4KICAgICAqLwogICAgcHJpdmF0ZSBFIGRlcXVldWUoKSB7CiAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAvLyBhc3NlcnQgaXRlbXNbdGFrZUluZGV4XSAhPSBudWxsOwogICAgICAgIGZpbmFsIE9iamVjdFtdIGl0ZW1zID0gdGhpcy5pdGVtczsKICAgICAgICBAU3VwcHJlc3NXYXJuaW5ncygidW5jaGVja2VkIikKICAgICAgICBFIHggPSAoRSkgaXRlbXNbdGFrZUluZGV4XTsKICAgICAgICBpdGVtc1t0YWtlSW5kZXhdID0gbnVsbDsKICAgICAgICBpZiAoKyt0YWtlSW5kZXggPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICB0YWtlSW5kZXggPSAwOwogICAgICAgIGNvdW50LS07CiAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgaXRycy5lbGVtZW50RGVxdWV1ZWQoKTsKICAgICAgICBub3RGdWxsLnNpZ25hbCgpOwogICAgICAgIHJldHVybiB4OwogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlcyBpdGVtIGF0IGFycmF5IGluZGV4IHJlbW92ZUluZGV4LgogICAgICogVXRpbGl0eSBmb3IgcmVtb3ZlKE9iamVjdCkgYW5kIGl0ZXJhdG9yLnJlbW92ZS4KICAgICAqIENhbGwgb25seSB3aGVuIGhvbGRpbmcgbG9jay4KICAgICAqLwogICAgdm9pZCByZW1vdmVBdChmaW5hbCBpbnQgcmVtb3ZlSW5kZXgpIHsKICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgIC8vIGFzc2VydCBpdGVtc1tyZW1vdmVJbmRleF0gIT0gbnVsbDsKICAgICAgICAvLyBhc3NlcnQgcmVtb3ZlSW5kZXggPj0gMCAmJiByZW1vdmVJbmRleCA8IGl0ZW1zLmxlbmd0aDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgaWYgKHJlbW92ZUluZGV4ID09IHRha2VJbmRleCkgewogICAgICAgICAgICAvLyByZW1vdmluZyBmcm9udCBpdGVtOyBqdXN0IGFkdmFuY2UKICAgICAgICAgICAgaXRlbXNbdGFrZUluZGV4XSA9IG51bGw7CiAgICAgICAgICAgIGlmICgrK3Rha2VJbmRleCA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0YWtlSW5kZXggPSAwOwogICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgICBpZiAoaXRycyAhPSBudWxsKQogICAgICAgICAgICAgICAgaXRycy5lbGVtZW50RGVxdWV1ZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBhbiAiaW50ZXJpb3IiIHJlbW92ZQoKICAgICAgICAgICAgLy8gc2xpZGUgb3ZlciBhbGwgb3RoZXJzIHVwIHRocm91Z2ggcHV0SW5kZXguCiAgICAgICAgICAgIGZpbmFsIGludCBwdXRJbmRleCA9IHRoaXMucHV0SW5kZXg7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSByZW1vdmVJbmRleDs7KSB7CiAgICAgICAgICAgICAgICBpbnQgbmV4dCA9IGkgKyAxOwogICAgICAgICAgICAgICAgaWYgKG5leHQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIG5leHQgPSAwOwogICAgICAgICAgICAgICAgaWYgKG5leHQgIT0gcHV0SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXSA9IGl0ZW1zW25leHRdOwogICAgICAgICAgICAgICAgICAgIGkgPSBuZXh0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXRJbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY291bnQtLTsKICAgICAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGl0cnMucmVtb3ZlZEF0KHJlbW92ZUluZGV4KTsKICAgICAgICB9CiAgICAgICAgbm90RnVsbC5zaWduYWwoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4ge0Bjb2RlIEFycmF5QmxvY2tpbmdRdWV1ZX0gd2l0aCB0aGUgZ2l2ZW4gKGZpeGVkKQogICAgICogY2FwYWNpdHkgYW5kIGRlZmF1bHQgYWNjZXNzIHBvbGljeS4KICAgICAqCiAgICAgKiBAcGFyYW0gY2FwYWNpdHkgdGhlIGNhcGFjaXR5IG9mIHRoaXMgcXVldWUKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBjYXBhY2l0eSA8IDF9CiAgICAgKi8KICAgIHB1YmxpYyBBcnJheUJsb2NraW5nUXVldWUoaW50IGNhcGFjaXR5KSB7CiAgICAgICAgdGhpcyhjYXBhY2l0eSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhbiB7QGNvZGUgQXJyYXlCbG9ja2luZ1F1ZXVlfSB3aXRoIHRoZSBnaXZlbiAoZml4ZWQpCiAgICAgKiBjYXBhY2l0eSBhbmQgdGhlIHNwZWNpZmllZCBhY2Nlc3MgcG9saWN5LgogICAgICoKICAgICAqIEBwYXJhbSBjYXBhY2l0eSB0aGUgY2FwYWNpdHkgb2YgdGhpcyBxdWV1ZQogICAgICogQHBhcmFtIGZhaXIgaWYge0Bjb2RlIHRydWV9IHRoZW4gcXVldWUgYWNjZXNzZXMgZm9yIHRocmVhZHMgYmxvY2tlZAogICAgICogICAgICAgIG9uIGluc2VydGlvbiBvciByZW1vdmFsLCBhcmUgcHJvY2Vzc2VkIGluIEZJRk8gb3JkZXI7CiAgICAgKiAgICAgICAgaWYge0Bjb2RlIGZhbHNlfSB0aGUgYWNjZXNzIG9yZGVyIGlzIHVuc3BlY2lmaWVkLgogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYge0Bjb2RlIGNhcGFjaXR5IDwgMX0KICAgICAqLwogICAgcHVibGljIEFycmF5QmxvY2tpbmdRdWV1ZShpbnQgY2FwYWNpdHksIGJvb2xlYW4gZmFpcikgewogICAgICAgIGlmIChjYXBhY2l0eSA8PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgdGhpcy5pdGVtcyA9IG5ldyBPYmplY3RbY2FwYWNpdHldOwogICAgICAgIGxvY2sgPSBuZXcgUmVlbnRyYW50TG9jayhmYWlyKTsKICAgICAgICBub3RFbXB0eSA9IGxvY2submV3Q29uZGl0aW9uKCk7CiAgICAgICAgbm90RnVsbCA9ICBsb2NrLm5ld0NvbmRpdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhbiB7QGNvZGUgQXJyYXlCbG9ja2luZ1F1ZXVlfSB3aXRoIHRoZSBnaXZlbiAoZml4ZWQpCiAgICAgKiBjYXBhY2l0eSwgdGhlIHNwZWNpZmllZCBhY2Nlc3MgcG9saWN5IGFuZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUKICAgICAqIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBjb2xsZWN0aW9uLAogICAgICogYWRkZWQgaW4gdHJhdmVyc2FsIG9yZGVyIG9mIHRoZSBjb2xsZWN0aW9uJ3MgaXRlcmF0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGNhcGFjaXR5IHRoZSBjYXBhY2l0eSBvZiB0aGlzIHF1ZXVlCiAgICAgKiBAcGFyYW0gZmFpciBpZiB7QGNvZGUgdHJ1ZX0gdGhlbiBxdWV1ZSBhY2Nlc3NlcyBmb3IgdGhyZWFkcyBibG9ja2VkCiAgICAgKiAgICAgICAgb24gaW5zZXJ0aW9uIG9yIHJlbW92YWwsIGFyZSBwcm9jZXNzZWQgaW4gRklGTyBvcmRlcjsKICAgICAqICAgICAgICBpZiB7QGNvZGUgZmFsc2V9IHRoZSBhY2Nlc3Mgb3JkZXIgaXMgdW5zcGVjaWZpZWQuCiAgICAgKiBAcGFyYW0gYyB0aGUgY29sbGVjdGlvbiBvZiBlbGVtZW50cyB0byBpbml0aWFsbHkgY29udGFpbgogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYge0Bjb2RlIGNhcGFjaXR5fSBpcyBsZXNzIHRoYW4KICAgICAqICAgICAgICAge0Bjb2RlIGMuc2l6ZSgpfSwgb3IgbGVzcyB0aGFuIDEuCiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBvciBhbnkKICAgICAqICAgICAgICAgb2YgaXRzIGVsZW1lbnRzIGFyZSBudWxsCiAgICAgKi8KICAgIHB1YmxpYyBBcnJheUJsb2NraW5nUXVldWUoaW50IGNhcGFjaXR5LCBib29sZWFuIGZhaXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbGxlY3Rpb248PyBleHRlbmRzIEU+IGMpIHsKICAgICAgICB0aGlzKGNhcGFjaXR5LCBmYWlyKTsKCiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOyAvLyBMb2NrIG9ubHkgZm9yIHZpc2liaWxpdHksIG5vdCBtdXR1YWwgZXhjbHVzaW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChFIGUgOiBjKSB7CiAgICAgICAgICAgICAgICAgICAgY2hlY2tOb3ROdWxsKGUpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zW2krK10gPSBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3VudCA9IGk7CiAgICAgICAgICAgIHB1dEluZGV4ID0gKGkgPT0gY2FwYWNpdHkpID8gMCA6IGk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnNlcnRzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBhdCB0aGUgdGFpbCBvZiB0aGlzIHF1ZXVlIGlmIGl0IGlzCiAgICAgKiBwb3NzaWJsZSB0byBkbyBzbyBpbW1lZGlhdGVseSB3aXRob3V0IGV4Y2VlZGluZyB0aGUgcXVldWUncyBjYXBhY2l0eSwKICAgICAqIHJldHVybmluZyB7QGNvZGUgdHJ1ZX0gdXBvbiBzdWNjZXNzIGFuZCB0aHJvd2luZyBhbgogICAgICoge0Bjb2RlIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbn0gaWYgdGhpcyBxdWV1ZSBpcyBmdWxsLgogICAgICoKICAgICAqIEBwYXJhbSBlIHRoZSBlbGVtZW50IHRvIGFkZAogICAgICogQHJldHVybiB7QGNvZGUgdHJ1ZX0gKGFzIHNwZWNpZmllZCBieSB7QGxpbmsgQ29sbGVjdGlvbiNhZGR9KQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhpcyBxdWV1ZSBpcyBmdWxsCiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpcyBudWxsCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZChFIGUpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYWRkKGUpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSBpZiBpdCBpcwogICAgICogcG9zc2libGUgdG8gZG8gc28gaW1tZWRpYXRlbHkgd2l0aG91dCBleGNlZWRpbmcgdGhlIHF1ZXVlJ3MgY2FwYWNpdHksCiAgICAgKiByZXR1cm5pbmcge0Bjb2RlIHRydWV9IHVwb24gc3VjY2VzcyBhbmQge0Bjb2RlIGZhbHNlfSBpZiB0aGlzIHF1ZXVlCiAgICAgKiBpcyBmdWxsLiAgVGhpcyBtZXRob2QgaXMgZ2VuZXJhbGx5IHByZWZlcmFibGUgdG8gbWV0aG9kIHtAbGluayAjYWRkfSwKICAgICAqIHdoaWNoIGNhbiBmYWlsIHRvIGluc2VydCBhbiBlbGVtZW50IG9ubHkgYnkgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLgogICAgICoKICAgICAqIEB0aHJvd3MgTnVsbFBvaW50ZXJFeGNlcHRpb24gaWYgdGhlIHNwZWNpZmllZCBlbGVtZW50IGlzIG51bGwKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gb2ZmZXIoRSBlKSB7CiAgICAgICAgY2hlY2tOb3ROdWxsKGUpOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGVucXVldWUoZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSwgd2FpdGluZwogICAgICogZm9yIHNwYWNlIHRvIGJlY29tZSBhdmFpbGFibGUgaWYgdGhlIHF1ZXVlIGlzIGZ1bGwuCiAgICAgKgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIHtAaW5oZXJpdERvY30KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0KEUgZSkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBjaGVja05vdE51bGwoZSk7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9ja0ludGVycnVwdGlibHkoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAoY291bnQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgbm90RnVsbC5hd2FpdCgpOwogICAgICAgICAgICBlbnF1ZXVlKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSwgd2FpdGluZwogICAgICogdXAgdG8gdGhlIHNwZWNpZmllZCB3YWl0IHRpbWUgZm9yIHNwYWNlIHRvIGJlY29tZSBhdmFpbGFibGUgaWYKICAgICAqIHRoZSBxdWV1ZSBpcyBmdWxsLgogICAgICoKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24ge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBOdWxsUG9pbnRlckV4Y2VwdGlvbiB7QGluaGVyaXREb2N9CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIG9mZmVyKEUgZSwgbG9uZyB0aW1lb3V0LCBUaW1lVW5pdCB1bml0KQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewoKICAgICAgICBjaGVja05vdE51bGwoZSk7CiAgICAgICAgbG9uZyBuYW5vcyA9IHVuaXQudG9OYW5vcyh0aW1lb3V0KTsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrSW50ZXJydXB0aWJseSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA9PSBpdGVtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChuYW5vcyA8PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIG5hbm9zID0gbm90RnVsbC5hd2FpdE5hbm9zKG5hbm9zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnF1ZXVlKGUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSBwb2xsKCkgewogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKGNvdW50ID09IDApID8gbnVsbCA6IGRlcXVldWUoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSB0YWtlKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrSW50ZXJydXB0aWJseSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA9PSAwKQogICAgICAgICAgICAgICAgbm90RW1wdHkuYXdhaXQoKTsKICAgICAgICAgICAgcmV0dXJuIGRlcXVldWUoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSBwb2xsKGxvbmcgdGltZW91dCwgVGltZVVuaXQgdW5pdCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBsb25nIG5hbm9zID0gdW5pdC50b05hbm9zKHRpbWVvdXQpOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2tJbnRlcnJ1cHRpYmx5KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChuYW5vcyA8PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgbmFub3MgPSBub3RFbXB0eS5hd2FpdE5hbm9zKG5hbm9zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGVxdWV1ZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBFIHBlZWsoKSB7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtQXQodGFrZUluZGV4KTsgLy8gbnVsbCB3aGVuIHF1ZXVlIGlzIGVtcHR5CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gdGhpcyBkb2MgY29tbWVudCBpcyBvdmVycmlkZGVuIHRvIHJlbW92ZSB0aGUgcmVmZXJlbmNlIHRvIGNvbGxlY3Rpb25zCiAgICAvLyBncmVhdGVyIGluIHNpemUgdGhhbiBJbnRlZ2VyLk1BWF9WQUxVRQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZQogICAgICovCiAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGRvYyBjb21tZW50IGlzIGEgbW9kaWZpZWQgY29weSBvZiB0aGUgaW5oZXJpdGVkIGRvYyBjb21tZW50LAogICAgLy8gd2l0aG91dCB0aGUgcmVmZXJlbmNlIHRvIHVubGltaXRlZCBxdWV1ZXMuCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBhZGRpdGlvbmFsIGVsZW1lbnRzIHRoYXQgdGhpcyBxdWV1ZSBjYW4gaWRlYWxseQogICAgICogKGluIHRoZSBhYnNlbmNlIG9mIG1lbW9yeSBvciByZXNvdXJjZSBjb25zdHJhaW50cykgYWNjZXB0IHdpdGhvdXQKICAgICAqIGJsb2NraW5nLiBUaGlzIGlzIGFsd2F5cyBlcXVhbCB0byB0aGUgaW5pdGlhbCBjYXBhY2l0eSBvZiB0aGlzIHF1ZXVlCiAgICAgKiBsZXNzIHRoZSBjdXJyZW50IHtAY29kZSBzaXplfSBvZiB0aGlzIHF1ZXVlLgogICAgICoKICAgICAqIDxwPk5vdGUgdGhhdCB5b3UgPGVtPmNhbm5vdDwvZW0+IGFsd2F5cyB0ZWxsIGlmIGFuIGF0dGVtcHQgdG8gaW5zZXJ0CiAgICAgKiBhbiBlbGVtZW50IHdpbGwgc3VjY2VlZCBieSBpbnNwZWN0aW5nIHtAY29kZSByZW1haW5pbmdDYXBhY2l0eX0KICAgICAqIGJlY2F1c2UgaXQgbWF5IGJlIHRoZSBjYXNlIHRoYXQgYW5vdGhlciB0aHJlYWQgaXMgYWJvdXQgdG8KICAgICAqIGluc2VydCBvciByZW1vdmUgYW4gZWxlbWVudC4KICAgICAqLwogICAgcHVibGljIGludCByZW1haW5pbmdDYXBhY2l0eSgpIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW1zLmxlbmd0aCAtIGNvdW50OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhIHNpbmdsZSBpbnN0YW5jZSBvZiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgZnJvbSB0aGlzIHF1ZXVlLAogICAgICogaWYgaXQgaXMgcHJlc2VudC4gIE1vcmUgZm9ybWFsbHksIHJlbW92ZXMgYW4gZWxlbWVudCB7QGNvZGUgZX0gc3VjaAogICAgICogdGhhdCB7QGNvZGUgby5lcXVhbHMoZSl9LCBpZiB0aGlzIHF1ZXVlIGNvbnRhaW5zIG9uZSBvciBtb3JlIHN1Y2gKICAgICAqIGVsZW1lbnRzLgogICAgICogUmV0dXJucyB7QGNvZGUgdHJ1ZX0gaWYgdGhpcyBxdWV1ZSBjb250YWluZWQgdGhlIHNwZWNpZmllZCBlbGVtZW50CiAgICAgKiAob3IgZXF1aXZhbGVudGx5LCBpZiB0aGlzIHF1ZXVlIGNoYW5nZWQgYXMgYSByZXN1bHQgb2YgdGhlIGNhbGwpLgogICAgICoKICAgICAqIDxwPlJlbW92YWwgb2YgaW50ZXJpb3IgZWxlbWVudHMgaW4gY2lyY3VsYXIgYXJyYXkgYmFzZWQgcXVldWVzCiAgICAgKiBpcyBhbiBpbnRyaW5zaWNhbGx5IHNsb3cgYW5kIGRpc3J1cHRpdmUgb3BlcmF0aW9uLCBzbyBzaG91bGQKICAgICAqIGJlIHVuZGVydGFrZW4gb25seSBpbiBleGNlcHRpb25hbCBjaXJjdW1zdGFuY2VzLCBpZGVhbGx5CiAgICAgKiBvbmx5IHdoZW4gdGhlIHF1ZXVlIGlzIGtub3duIG5vdCB0byBiZSBhY2Nlc3NpYmxlIGJ5IG90aGVyCiAgICAgKiB0aHJlYWRzLgogICAgICoKICAgICAqIEBwYXJhbSBvIGVsZW1lbnQgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoaXMgcXVldWUsIGlmIHByZXNlbnQKICAgICAqIEByZXR1cm4ge0Bjb2RlIHRydWV9IGlmIHRoaXMgcXVldWUgY2hhbmdlZCBhcyBhIHJlc3VsdCBvZiB0aGUgY2FsbAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG8pIHsKICAgICAgICBpZiAobyA9PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgZmluYWwgT2JqZWN0W10gaXRlbXMgPSB0aGlzLml0ZW1zOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgcHV0SW5kZXggPSB0aGlzLnB1dEluZGV4OwogICAgICAgICAgICAgICAgaW50IGkgPSB0YWtlSW5kZXg7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG8uZXF1YWxzKGl0ZW1zW2ldKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgrK2kgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGkgIT0gcHV0SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMge0Bjb2RlIHRydWV9IGlmIHRoaXMgcXVldWUgY29udGFpbnMgdGhlIHNwZWNpZmllZCBlbGVtZW50LgogICAgICogTW9yZSBmb3JtYWxseSwgcmV0dXJucyB7QGNvZGUgdHJ1ZX0gaWYgYW5kIG9ubHkgaWYgdGhpcyBxdWV1ZSBjb250YWlucwogICAgICogYXQgbGVhc3Qgb25lIGVsZW1lbnQge0Bjb2RlIGV9IHN1Y2ggdGhhdCB7QGNvZGUgby5lcXVhbHMoZSl9LgogICAgICoKICAgICAqIEBwYXJhbSBvIG9iamVjdCB0byBiZSBjaGVja2VkIGZvciBjb250YWlubWVudCBpbiB0aGlzIHF1ZXVlCiAgICAgKiBAcmV0dXJuIHtAY29kZSB0cnVlfSBpZiB0aGlzIHF1ZXVlIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgZWxlbWVudAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3QgbykgewogICAgICAgIGlmIChvID09IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBwdXRJbmRleCA9IHRoaXMucHV0SW5kZXg7CiAgICAgICAgICAgICAgICBpbnQgaSA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBpZiAoby5lcXVhbHMoaXRlbXNbaV0pKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoKytpID09IGl0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChpICE9IHB1dEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlLCBpbgogICAgICogcHJvcGVyIHNlcXVlbmNlLgogICAgICoKICAgICAqIDxwPlRoZSByZXR1cm5lZCBhcnJheSB3aWxsIGJlICJzYWZlIiBpbiB0aGF0IG5vIHJlZmVyZW5jZXMgdG8gaXQgYXJlCiAgICAgKiBtYWludGFpbmVkIGJ5IHRoaXMgcXVldWUuICAoSW4gb3RoZXIgd29yZHMsIHRoaXMgbWV0aG9kIG11c3QgYWxsb2NhdGUKICAgICAqIGEgbmV3IGFycmF5KS4gIFRoZSBjYWxsZXIgaXMgdGh1cyBmcmVlIHRvIG1vZGlmeSB0aGUgcmV0dXJuZWQgYXJyYXkuCiAgICAgKgogICAgICogPHA+VGhpcyBtZXRob2QgYWN0cyBhcyBicmlkZ2UgYmV0d2VlbiBhcnJheS1iYXNlZCBhbmQgY29sbGVjdGlvbi1iYXNlZAogICAgICogQVBJcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KCkgewogICAgICAgIE9iamVjdFtdIGE7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpbmFsIGludCBjb3VudCA9IHRoaXMuY291bnQ7CiAgICAgICAgICAgIGEgPSBuZXcgT2JqZWN0W2NvdW50XTsKICAgICAgICAgICAgaW50IG4gPSBpdGVtcy5sZW5ndGggLSB0YWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChjb3VudCA8PSBuKQogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgdGFrZUluZGV4LCBhLCAwLCBjb3VudCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgdGFrZUluZGV4LCBhLCAwLCBuKTsKICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoaXRlbXMsIDAsIGEsIG4sIGNvdW50IC0gbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyBhbGwgb2YgdGhlIGVsZW1lbnRzIGluIHRoaXMgcXVldWUsIGluCiAgICAgKiBwcm9wZXIgc2VxdWVuY2U7IHRoZSBydW50aW1lIHR5cGUgb2YgdGhlIHJldHVybmVkIGFycmF5IGlzIHRoYXQgb2YKICAgICAqIHRoZSBzcGVjaWZpZWQgYXJyYXkuICBJZiB0aGUgcXVldWUgZml0cyBpbiB0aGUgc3BlY2lmaWVkIGFycmF5LCBpdAogICAgICogaXMgcmV0dXJuZWQgdGhlcmVpbi4gIE90aGVyd2lzZSwgYSBuZXcgYXJyYXkgaXMgYWxsb2NhdGVkIHdpdGggdGhlCiAgICAgKiBydW50aW1lIHR5cGUgb2YgdGhlIHNwZWNpZmllZCBhcnJheSBhbmQgdGhlIHNpemUgb2YgdGhpcyBxdWV1ZS4KICAgICAqCiAgICAgKiA8cD5JZiB0aGlzIHF1ZXVlIGZpdHMgaW4gdGhlIHNwZWNpZmllZCBhcnJheSB3aXRoIHJvb20gdG8gc3BhcmUKICAgICAqIChpLmUuLCB0aGUgYXJyYXkgaGFzIG1vcmUgZWxlbWVudHMgdGhhbiB0aGlzIHF1ZXVlKSwgdGhlIGVsZW1lbnQgaW4KICAgICAqIHRoZSBhcnJheSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlIGVuZCBvZiB0aGUgcXVldWUgaXMgc2V0IHRvCiAgICAgKiB7QGNvZGUgbnVsbH0uCiAgICAgKgogICAgICogPHA+TGlrZSB0aGUge0BsaW5rICN0b0FycmF5KCl9IG1ldGhvZCwgdGhpcyBtZXRob2QgYWN0cyBhcyBicmlkZ2UgYmV0d2VlbgogICAgICogYXJyYXktYmFzZWQgYW5kIGNvbGxlY3Rpb24tYmFzZWQgQVBJcy4gIEZ1cnRoZXIsIHRoaXMgbWV0aG9kIGFsbG93cwogICAgICogcHJlY2lzZSBjb250cm9sIG92ZXIgdGhlIHJ1bnRpbWUgdHlwZSBvZiB0aGUgb3V0cHV0IGFycmF5LCBhbmQgbWF5LAogICAgICogdW5kZXIgY2VydGFpbiBjaXJjdW1zdGFuY2VzLCBiZSB1c2VkIHRvIHNhdmUgYWxsb2NhdGlvbiBjb3N0cy4KICAgICAqCiAgICAgKiA8cD5TdXBwb3NlIHtAY29kZSB4fSBpcyBhIHF1ZXVlIGtub3duIHRvIGNvbnRhaW4gb25seSBzdHJpbmdzLgogICAgICogVGhlIGZvbGxvd2luZyBjb2RlIGNhbiBiZSB1c2VkIHRvIGR1bXAgdGhlIHF1ZXVlIGludG8gYSBuZXdseQogICAgICogYWxsb2NhdGVkIGFycmF5IG9mIHtAY29kZSBTdHJpbmd9OgogICAgICoKICAgICAqICA8cHJlPiB7QGNvZGUgU3RyaW5nW10geSA9IHgudG9BcnJheShuZXcgU3RyaW5nWzBdKTt9PC9wcmU+CiAgICAgKgogICAgICogTm90ZSB0aGF0IHtAY29kZSB0b0FycmF5KG5ldyBPYmplY3RbMF0pfSBpcyBpZGVudGljYWwgaW4gZnVuY3Rpb24gdG8KICAgICAqIHtAY29kZSB0b0FycmF5KCl9LgogICAgICoKICAgICAqIEBwYXJhbSBhIHRoZSBhcnJheSBpbnRvIHdoaWNoIHRoZSBlbGVtZW50cyBvZiB0aGUgcXVldWUgYXJlIHRvCiAgICAgKiAgICAgICAgICBiZSBzdG9yZWQsIGlmIGl0IGlzIGJpZyBlbm91Z2g7IG90aGVyd2lzZSwgYSBuZXcgYXJyYXkgb2YgdGhlCiAgICAgKiAgICAgICAgICBzYW1lIHJ1bnRpbWUgdHlwZSBpcyBhbGxvY2F0ZWQgZm9yIHRoaXMgcHVycG9zZQogICAgICogQHJldHVybiBhbiBhcnJheSBjb250YWluaW5nIGFsbCBvZiB0aGUgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZQogICAgICogQHRocm93cyBBcnJheVN0b3JlRXhjZXB0aW9uIGlmIHRoZSBydW50aW1lIHR5cGUgb2YgdGhlIHNwZWNpZmllZCBhcnJheQogICAgICogICAgICAgICBpcyBub3QgYSBzdXBlcnR5cGUgb2YgdGhlIHJ1bnRpbWUgdHlwZSBvZiBldmVyeSBlbGVtZW50IGluCiAgICAgKiAgICAgICAgIHRoaXMgcXVldWUKICAgICAqIEB0aHJvd3MgTnVsbFBvaW50ZXJFeGNlcHRpb24gaWYgdGhlIHNwZWNpZmllZCBhcnJheSBpcyBudWxsCiAgICAgKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgcHVibGljIDxUPiBUW10gdG9BcnJheShUW10gYSkgewogICAgICAgIGZpbmFsIE9iamVjdFtdIGl0ZW1zID0gdGhpcy5pdGVtczsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluYWwgaW50IGNvdW50ID0gdGhpcy5jb3VudDsKICAgICAgICAgICAgZmluYWwgaW50IGxlbiA9IGEubGVuZ3RoOwogICAgICAgICAgICBpZiAobGVuIDwgY291bnQpCiAgICAgICAgICAgICAgICBhID0gKFRbXSlqYXZhLmxhbmcucmVmbGVjdC5BcnJheS5uZXdJbnN0YW5jZSgKICAgICAgICAgICAgICAgICAgICAgICAgYS5nZXRDbGFzcygpLmdldENvbXBvbmVudFR5cGUoKSwgY291bnQpOwogICAgICAgICAgICBpbnQgbiA9IGl0ZW1zLmxlbmd0aCAtIHRha2VJbmRleDsKICAgICAgICAgICAgaWYgKGNvdW50IDw9IG4pCiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGl0ZW1zLCB0YWtlSW5kZXgsIGEsIDAsIGNvdW50KTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGl0ZW1zLCB0YWtlSW5kZXgsIGEsIDAsIG4pOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgMCwgYSwgbiwgY291bnQgLSBuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGVuID4gY291bnQpCiAgICAgICAgICAgICAgICBhW2NvdW50XSA9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGsgPSBjb3VudDsKICAgICAgICAgICAgaWYgKGsgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiAiW10iOwoKICAgICAgICAgICAgZmluYWwgT2JqZWN0W10gaXRlbXMgPSB0aGlzLml0ZW1zOwogICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCdbJyk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSB0YWtlSW5kZXg7IDsgKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZSA9IGl0ZW1zW2ldOwogICAgICAgICAgICAgICAgc2IuYXBwZW5kKGUgPT0gdGhpcyA/ICIodGhpcyBDb2xsZWN0aW9uKSIgOiBlKTsKICAgICAgICAgICAgICAgIGlmICgtLWsgPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2IuYXBwZW5kKCddJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgnLCcpLmFwcGVuZCgnICcpOwogICAgICAgICAgICAgICAgaWYgKCsraSA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEF0b21pY2FsbHkgcmVtb3ZlcyBhbGwgb2YgdGhlIGVsZW1lbnRzIGZyb20gdGhpcyBxdWV1ZS4KICAgICAqIFRoZSBxdWV1ZSB3aWxsIGJlIGVtcHR5IGFmdGVyIHRoaXMgY2FsbCByZXR1cm5zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBrID0gY291bnQ7CiAgICAgICAgICAgIGlmIChrID4gMCkgewogICAgICAgICAgICAgICAgZmluYWwgaW50IHB1dEluZGV4ID0gdGhpcy5wdXRJbmRleDsKICAgICAgICAgICAgICAgIGludCBpID0gdGFrZUluZGV4OwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoKytpID09IGl0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChpICE9IHB1dEluZGV4KTsKICAgICAgICAgICAgICAgIHRha2VJbmRleCA9IHB1dEluZGV4OwogICAgICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpdHJzLnF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICAgICAgZm9yICg7IGsgPiAwICYmIGxvY2suaGFzV2FpdGVycyhub3RGdWxsKTsgay0tKQogICAgICAgICAgICAgICAgICAgIG5vdEZ1bGwuc2lnbmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEB0aHJvd3MgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24ge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBDbGFzc0Nhc3RFeGNlcHRpb24gICAgICAgICAgICB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uICAgICAgICAgIHtAaW5oZXJpdERvY30KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICAgICAge0Bpbmhlcml0RG9jfQogICAgICovCiAgICBwdWJsaWMgaW50IGRyYWluVG8oQ29sbGVjdGlvbjw/IHN1cGVyIEU+IGMpIHsKICAgICAgICByZXR1cm4gZHJhaW5UbyhjLCBJbnRlZ2VyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAdGhyb3dzIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uIHtAaW5oZXJpdERvY30KICAgICAqIEB0aHJvd3MgQ2xhc3NDYXN0RXhjZXB0aW9uICAgICAgICAgICAge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBOdWxsUG9pbnRlckV4Y2VwdGlvbiAgICAgICAgICB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAgICAgIHtAaW5oZXJpdERvY30KICAgICAqLwogICAgcHVibGljIGludCBkcmFpblRvKENvbGxlY3Rpb248PyBzdXBlciBFPiBjLCBpbnQgbWF4RWxlbWVudHMpIHsKICAgICAgICBjaGVja05vdE51bGwoYyk7CiAgICAgICAgaWYgKGMgPT0gdGhpcykKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgIGlmIChtYXhFbGVtZW50cyA8PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBuID0gTWF0aC5taW4obWF4RWxlbWVudHMsIGNvdW50KTsKICAgICAgICAgICAgaW50IHRha2UgPSB0YWtlSW5kZXg7CiAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgbikgewogICAgICAgICAgICAgICAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgICAgICAgICAgICAgICAgIEUgeCA9IChFKSBpdGVtc1t0YWtlXTsKICAgICAgICAgICAgICAgICAgICBjLmFkZCh4KTsKICAgICAgICAgICAgICAgICAgICBpdGVtc1t0YWtlXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKCsrdGFrZSA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRha2UgPSAwOwogICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBpbnZhcmlhbnRzIGV2ZW4gaWYgYy5hZGQoKSB0aHJldwogICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY291bnQgLT0gaTsKICAgICAgICAgICAgICAgICAgICB0YWtlSW5kZXggPSB0YWtlOwogICAgICAgICAgICAgICAgICAgIGlmIChpdHJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdHJzLnF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gdGFrZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMudGFrZUluZGV4V3JhcHBlZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKDsgaSA+IDAgJiYgbG9jay5oYXNXYWl0ZXJzKG5vdEZ1bGwpOyBpLS0pCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdEZ1bGwuc2lnbmFsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gaXRlcmF0b3Igb3ZlciB0aGUgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZSBpbiBwcm9wZXIgc2VxdWVuY2UuCiAgICAgKiBUaGUgZWxlbWVudHMgd2lsbCBiZSByZXR1cm5lZCBpbiBvcmRlciBmcm9tIGZpcnN0IChoZWFkKSB0byBsYXN0ICh0YWlsKS4KICAgICAqCiAgICAgKiA8cD5UaGUgcmV0dXJuZWQgaXRlcmF0b3IgaXMKICAgICAqIDxhIGhyZWY9InBhY2thZ2Utc3VtbWFyeS5odG1sI1dlYWtseSI+PGk+d2Vha2x5IGNvbnNpc3RlbnQ8L2k+PC9hPi4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIGVsZW1lbnRzIGluIHRoaXMgcXVldWUgaW4gcHJvcGVyIHNlcXVlbmNlCiAgICAgKi8KICAgIHB1YmxpYyBJdGVyYXRvcjxFPiBpdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gbmV3IGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNoYXJlZCBkYXRhIGJldHdlZW4gaXRlcmF0b3JzIGFuZCB0aGVpciBxdWV1ZSwgYWxsb3dpbmcgcXVldWUKICAgICAqIG1vZGlmaWNhdGlvbnMgdG8gdXBkYXRlIGl0ZXJhdG9ycyB3aGVuIGVsZW1lbnRzIGFyZSByZW1vdmVkLgogICAgICoKICAgICAqIFRoaXMgYWRkcyBhIGxvdCBvZiBjb21wbGV4aXR5IGZvciB0aGUgc2FrZSBvZiBjb3JyZWN0bHkKICAgICAqIGhhbmRsaW5nIHNvbWUgdW5jb21tb24gb3BlcmF0aW9ucywgYnV0IHRoZSBjb21iaW5hdGlvbiBvZgogICAgICogY2lyY3VsYXItYXJyYXlzIGFuZCBzdXBwb3J0aW5nIGludGVyaW9yIHJlbW92ZXMgKGkuZS4sIHRob3NlCiAgICAgKiBub3QgYXQgaGVhZCkgd291bGQgY2F1c2UgaXRlcmF0b3JzIHRvIHNvbWV0aW1lcyBsb3NlIHRoZWlyCiAgICAgKiBwbGFjZXMgYW5kL29yIChyZSlyZXBvcnQgZWxlbWVudHMgdGhleSBzaG91bGRuJ3QuICBUbyBhdm9pZAogICAgICogdGhpcywgd2hlbiBhIHF1ZXVlIGhhcyBvbmUgb3IgbW9yZSBpdGVyYXRvcnMsIGl0IGtlZXBzIGl0ZXJhdG9yCiAgICAgKiBzdGF0ZSBjb25zaXN0ZW50IGJ5OgogICAgICoKICAgICAqICgxKSBrZWVwaW5nIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgImN5Y2xlcyIsIHRoYXQgaXMsIHRoZQogICAgICogICAgIG51bWJlciBvZiB0aW1lcyB0YWtlSW5kZXggaGFzIHdyYXBwZWQgYXJvdW5kIHRvIDAuCiAgICAgKiAoMikgbm90aWZ5aW5nIGFsbCBpdGVyYXRvcnMgdmlhIHRoZSBjYWxsYmFjayByZW1vdmVkQXQgd2hlbmV2ZXIKICAgICAqICAgICBhbiBpbnRlcmlvciBlbGVtZW50IGlzIHJlbW92ZWQgKGFuZCB0aHVzIG90aGVyIGVsZW1lbnRzIG1heQogICAgICogICAgIGJlIHNoaWZ0ZWQpLgogICAgICoKICAgICAqIFRoZXNlIHN1ZmZpY2UgdG8gZWxpbWluYXRlIGl0ZXJhdG9yIGluY29uc2lzdGVuY2llcywgYnV0CiAgICAgKiB1bmZvcnR1bmF0ZWx5IGFkZCB0aGUgc2Vjb25kYXJ5IHJlc3BvbnNpYmlsaXR5IG9mIG1haW50YWluaW5nCiAgICAgKiB0aGUgbGlzdCBvZiBpdGVyYXRvcnMuICBXZSB0cmFjayBhbGwgYWN0aXZlIGl0ZXJhdG9ycyBpbiBhCiAgICAgKiBzaW1wbGUgbGlua2VkIGxpc3QgKGFjY2Vzc2VkIG9ubHkgd2hlbiB0aGUgcXVldWUncyBsb2NrIGlzCiAgICAgKiBoZWxkKSBvZiB3ZWFrIHJlZmVyZW5jZXMgdG8gSXRyLiAgVGhlIGxpc3QgaXMgY2xlYW5lZCB1cCB1c2luZwogICAgICogMyBkaWZmZXJlbnQgbWVjaGFuaXNtczoKICAgICAqCiAgICAgKiAoMSkgV2hlbmV2ZXIgYSBuZXcgaXRlcmF0b3IgaXMgY3JlYXRlZCwgZG8gc29tZSBPKDEpIGNoZWNraW5nIGZvcgogICAgICogICAgIHN0YWxlIGxpc3QgZWxlbWVudHMuCiAgICAgKgogICAgICogKDIpIFdoZW5ldmVyIHRha2VJbmRleCB3cmFwcyBhcm91bmQgdG8gMCwgY2hlY2sgZm9yIGl0ZXJhdG9ycwogICAgICogICAgIHRoYXQgaGF2ZSBiZWVuIHVudXNlZCBmb3IgbW9yZSB0aGFuIG9uZSB3cmFwLWFyb3VuZCBjeWNsZS4KICAgICAqCiAgICAgKiAoMykgV2hlbmV2ZXIgdGhlIHF1ZXVlIGJlY29tZXMgZW1wdHksIGFsbCBpdGVyYXRvcnMgYXJlIG5vdGlmaWVkCiAgICAgKiAgICAgYW5kIHRoaXMgZW50aXJlIGRhdGEgc3RydWN0dXJlIGlzIGRpc2NhcmRlZC4KICAgICAqCiAgICAgKiBTbyBpbiBhZGRpdGlvbiB0byB0aGUgcmVtb3ZlZEF0IGNhbGxiYWNrIHRoYXQgaXMgbmVjZXNzYXJ5IGZvcgogICAgICogY29ycmVjdG5lc3MsIGl0ZXJhdG9ycyBoYXZlIHRoZSBzaHV0ZG93biBhbmQgdGFrZUluZGV4V3JhcHBlZAogICAgICogY2FsbGJhY2tzIHRoYXQgaGVscCByZW1vdmUgc3RhbGUgaXRlcmF0b3JzIGZyb20gdGhlIGxpc3QuCiAgICAgKgogICAgICogV2hlbmV2ZXIgYSBsaXN0IGVsZW1lbnQgaXMgZXhhbWluZWQsIGl0IGlzIGV4cHVuZ2VkIGlmIGVpdGhlcgogICAgICogdGhlIEdDIGhhcyBkZXRlcm1pbmVkIHRoYXQgdGhlIGl0ZXJhdG9yIGlzIGRpc2NhcmRlZCwgb3IgaWYgdGhlCiAgICAgKiBpdGVyYXRvciByZXBvcnRzIHRoYXQgaXQgaXMgImRldGFjaGVkIiAoZG9lcyBub3QgbmVlZCBhbnkKICAgICAqIGZ1cnRoZXIgc3RhdGUgdXBkYXRlcykuICBPdmVyaGVhZCBpcyBtYXhpbWFsIHdoZW4gdGFrZUluZGV4CiAgICAgKiBuZXZlciBhZHZhbmNlcywgaXRlcmF0b3JzIGFyZSBkaXNjYXJkZWQgYmVmb3JlIHRoZXkgYXJlCiAgICAgKiBleGhhdXN0ZWQsIGFuZCBhbGwgcmVtb3ZhbHMgYXJlIGludGVyaW9yIHJlbW92ZXMsIGluIHdoaWNoIGNhc2UKICAgICAqIGFsbCBzdGFsZSBpdGVyYXRvcnMgYXJlIGRpc2NvdmVyZWQgYnkgdGhlIEdDLiAgQnV0IGV2ZW4gaW4gdGhpcwogICAgICogY2FzZSB3ZSBkb24ndCBpbmNyZWFzZSB0aGUgYW1vcnRpemVkIGNvbXBsZXhpdHkuCiAgICAgKgogICAgICogQ2FyZSBtdXN0IGJlIHRha2VuIHRvIGtlZXAgbGlzdCBzd2VlcGluZyBtZXRob2RzIGZyb20KICAgICAqIHJlZW50cmFudGx5IGludm9raW5nIGFub3RoZXIgc3VjaCBtZXRob2QsIGNhdXNpbmcgc3VidGxlCiAgICAgKiBjb3JydXB0aW9uIGJ1Z3MuCiAgICAgKi8KICAgIGNsYXNzIEl0cnMgewoKICAgICAgICAvKioKICAgICAgICAgKiBOb2RlIGluIGEgbGlua2VkIGxpc3Qgb2Ygd2VhayBpdGVyYXRvciByZWZlcmVuY2VzLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgY2xhc3MgTm9kZSBleHRlbmRzIFdlYWtSZWZlcmVuY2U8amF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0cj4gewogICAgICAgICAgICBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQ7CgogICAgICAgICAgICBOb2RlKGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHIgaXRlcmF0b3IsIGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgbmV4dCkgewogICAgICAgICAgICAgICAgc3VwZXIoaXRlcmF0b3IpOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqIEluY3JlbWVudGVkIHdoZW5ldmVyIHRha2VJbmRleCB3cmFwcyBhcm91bmQgdG8gMCAqLwogICAgICAgIGludCBjeWNsZXMgPSAwOwoKICAgICAgICAvKiogTGlua2VkIGxpc3Qgb2Ygd2VhayBpdGVyYXRvciByZWZlcmVuY2VzICovCiAgICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIGhlYWQ7CgogICAgICAgIC8qKiBVc2VkIHRvIGV4cHVuZ2Ugc3RhbGUgaXRlcmF0b3JzICovCiAgICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIHN3ZWVwZXIgPSBudWxsOwoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgU0hPUlRfU1dFRVBfUFJPQkVTID0gNDsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTE9OR19TV0VFUF9QUk9CRVMgPSAxNjsKCiAgICAgICAgSXRycyhqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRyIGluaXRpYWwpIHsKICAgICAgICAgICAgcmVnaXN0ZXIoaW5pdGlhbCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTd2VlcHMgaXRycywgbG9va2luZyBmb3IgYW5kIGV4cHVuZ2luZyBzdGFsZSBpdGVyYXRvcnMuCiAgICAgICAgICogSWYgYXQgbGVhc3Qgb25lIHdhcyBmb3VuZCwgdHJpZXMgaGFyZGVyIHRvIGZpbmQgbW9yZS4KICAgICAgICAgKiBDYWxsZWQgb25seSBmcm9tIGl0ZXJhdGluZyB0aHJlYWQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdHJ5SGFyZGVyIHdoZXRoZXIgdG8gc3RhcnQgaW4gdHJ5LWhhcmRlciBtb2RlLCBiZWNhdXNlCiAgICAgICAgICogdGhlcmUgaXMga25vd24gdG8gYmUgYXQgbGVhc3Qgb25lIGl0ZXJhdG9yIHRvIGNvbGxlY3QKICAgICAgICAgKi8KICAgICAgICB2b2lkIGRvU29tZVN3ZWVwaW5nKGJvb2xlYW4gdHJ5SGFyZGVyKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDE7CiAgICAgICAgICAgIC8vIGFzc2VydCBoZWFkICE9IG51bGw7CiAgICAgICAgICAgIGludCBwcm9iZXMgPSB0cnlIYXJkZXIgPyBMT05HX1NXRUVQX1BST0JFUyA6IFNIT1JUX1NXRUVQX1BST0JFUzsKICAgICAgICAgICAgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0cnMuTm9kZSBvLCBwOwogICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIHN3ZWVwZXIgPSB0aGlzLnN3ZWVwZXI7CiAgICAgICAgICAgIGJvb2xlYW4gcGFzc2VkR287ICAgLy8gdG8gbGltaXQgc2VhcmNoIHRvIG9uZSBmdWxsIHN3ZWVwCgogICAgICAgICAgICBpZiAoc3dlZXBlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgICAgIHAgPSBoZWFkOwogICAgICAgICAgICAgICAgcGFzc2VkR28gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbyA9IHN3ZWVwZXI7CiAgICAgICAgICAgICAgICBwID0gby5uZXh0OwogICAgICAgICAgICAgICAgcGFzc2VkR28gPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICg7IHByb2JlcyA+IDA7IHByb2Jlcy0tKSB7CiAgICAgICAgICAgICAgICBpZiAocCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhc3NlZEdvKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBwID0gaGVhZDsKICAgICAgICAgICAgICAgICAgICBwYXNzZWRHbyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRyIGl0ID0gcC5nZXQoKTsKICAgICAgICAgICAgICAgIGZpbmFsIGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgbmV4dCA9IHAubmV4dDsKICAgICAgICAgICAgICAgIGlmIChpdCA9PSBudWxsIHx8IGl0LmlzRGV0YWNoZWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGZvdW5kIGEgZGlzY2FyZGVkL2V4aGF1c3RlZCBpdGVyYXRvcgogICAgICAgICAgICAgICAgICAgIHByb2JlcyA9IExPTkdfU1dFRVBfUFJPQkVTOyAvLyAidHJ5IGhhcmRlciIKICAgICAgICAgICAgICAgICAgICAvLyB1bmxpbmsgcAogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBwLm5leHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZCA9IG5leHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlJ3ZlIHJ1biBvdXQgb2YgaXRlcmF0b3JzIHRvIHRyYWNrOyByZXRpcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgby5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbyA9IHA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwID0gbmV4dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zd2VlcGVyID0gKHAgPT0gbnVsbCkgPyBudWxsIDogbzsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYSBuZXcgaXRlcmF0b3IgdG8gdGhlIGxpbmtlZCBsaXN0IG9mIHRyYWNrZWQgaXRlcmF0b3JzLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcmVnaXN0ZXIoamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdHIpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaGVhZCA9IG5ldyBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlKGl0ciwgaGVhZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgd2hlbmV2ZXIgdGFrZUluZGV4IHdyYXBzIGFyb3VuZCB0byAwLgogICAgICAgICAqCiAgICAgICAgICogTm90aWZpZXMgYWxsIGl0ZXJhdG9ycywgYW5kIGV4cHVuZ2VzIGFueSB0aGF0IGFyZSBub3cgc3RhbGUuCiAgICAgICAgICovCiAgICAgICAgdm9pZCB0YWtlSW5kZXhXcmFwcGVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBjeWNsZXMrKzsKICAgICAgICAgICAgZm9yIChqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG8gPSBudWxsLCBwID0gaGVhZDsgcCAhPSBudWxsOykgewogICAgICAgICAgICAgICAgZmluYWwgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQgPSBwLm5leHQ7CiAgICAgICAgICAgICAgICBpZiAoaXQgPT0gbnVsbCB8fCBpdC50YWtlSW5kZXhXcmFwcGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB1bmxpbmsgcAogICAgICAgICAgICAgICAgICAgIC8vIGFzc2VydCBpdCA9PSBudWxsIHx8IGl0LmlzRGV0YWNoZWQoKTsKICAgICAgICAgICAgICAgICAgICBwLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcC5uZXh0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAobyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkID0gbmV4dDsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG8ubmV4dCA9IG5leHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG8gPSBwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcCA9IG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWQgPT0gbnVsbCkgICAvLyBubyBtb3JlIGl0ZXJhdG9ycyB0byB0cmFjawogICAgICAgICAgICAgICAgaXRycyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgd2hlbmV2ZXIgYW4gaW50ZXJpb3IgcmVtb3ZlIChub3QgYXQgdGFrZUluZGV4KSBvY2N1cnJlZC4KICAgICAgICAgKgogICAgICAgICAqIE5vdGlmaWVzIGFsbCBpdGVyYXRvcnMsIGFuZCBleHB1bmdlcyBhbnkgdGhhdCBhcmUgbm93IHN0YWxlLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcmVtb3ZlZEF0KGludCByZW1vdmVkSW5kZXgpIHsKICAgICAgICAgICAgZm9yIChqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG8gPSBudWxsLCBwID0gaGVhZDsgcCAhPSBudWxsOykgewogICAgICAgICAgICAgICAgZmluYWwgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQgPSBwLm5leHQ7CiAgICAgICAgICAgICAgICBpZiAoaXQgPT0gbnVsbCB8fCBpdC5yZW1vdmVkQXQocmVtb3ZlZEluZGV4KSkgewogICAgICAgICAgICAgICAgICAgIC8vIHVubGluayBwCiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGl0ID09IG51bGwgfHwgaXQuaXNEZXRhY2hlZCgpOwogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBwLm5leHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQgPSBuZXh0OwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgby5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbyA9IHA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZCA9PSBudWxsKSAgIC8vIG5vIG1vcmUgaXRlcmF0b3JzIHRvIHRyYWNrCiAgICAgICAgICAgICAgICBpdHJzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciB0aGUgcXVldWUgYmVjb21lcyBlbXB0eS4KICAgICAgICAgKgogICAgICAgICAqIE5vdGlmaWVzIGFsbCBhY3RpdmUgaXRlcmF0b3JzIHRoYXQgdGhlIHF1ZXVlIGlzIGVtcHR5LAogICAgICAgICAqIGNsZWFycyBhbGwgd2VhayByZWZzLCBhbmQgdW5saW5rcyB0aGUgaXRycyBkYXRhc3RydWN0dXJlLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcXVldWVJc0VtcHR5KCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBmb3IgKGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgcCA9IGhlYWQ7IHAgIT0gbnVsbDsgcCA9IHAubmV4dCkgewogICAgICAgICAgICAgICAgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoaXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBpdC5zaHV0ZG93bigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGhlYWQgPSBudWxsOwogICAgICAgICAgICBpdHJzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciBhbiBlbGVtZW50IGhhcyBiZWVuIGRlcXVldWVkIChhdCB0YWtlSW5kZXgpLgogICAgICAgICAqLwogICAgICAgIHZvaWQgZWxlbWVudERlcXVldWVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBpZiAoY291bnQgPT0gMCkKICAgICAgICAgICAgICAgIHF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICBlbHNlIGlmICh0YWtlSW5kZXggPT0gMCkKICAgICAgICAgICAgICAgIHRha2VJbmRleFdyYXBwZWQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJdGVyYXRvciBmb3IgQXJyYXlCbG9ja2luZ1F1ZXVlLgogICAgICoKICAgICAqIFRvIG1haW50YWluIHdlYWsgY29uc2lzdGVuY3kgd2l0aCByZXNwZWN0IHRvIHB1dHMgYW5kIHRha2VzLCB3ZQogICAgICogcmVhZCBhaGVhZCBvbmUgc2xvdCwgc28gYXMgdG8gbm90IHJlcG9ydCBoYXNOZXh0IHRydWUgYnV0IHRoZW4KICAgICAqIG5vdCBoYXZlIGFuIGVsZW1lbnQgdG8gcmV0dXJuLgogICAgICoKICAgICAqIFdlIHN3aXRjaCBpbnRvICJkZXRhY2hlZCIgbW9kZSAoYWxsb3dpbmcgcHJvbXB0IHVubGlua2luZyBmcm9tCiAgICAgKiBpdHJzIHdpdGhvdXQgaGVscCBmcm9tIHRoZSBHQykgd2hlbiBhbGwgaW5kaWNlcyBhcmUgbmVnYXRpdmUsIG9yCiAgICAgKiB3aGVuIGhhc05leHQgcmV0dXJucyBmYWxzZSBmb3IgdGhlIGZpcnN0IHRpbWUuICBUaGlzIGFsbG93cyB0aGUKICAgICAqIGl0ZXJhdG9yIHRvIHRyYWNrIGNvbmN1cnJlbnQgdXBkYXRlcyBjb21wbGV0ZWx5IGFjY3VyYXRlbHksCiAgICAgKiBleGNlcHQgZm9yIHRoZSBjb3JuZXIgY2FzZSBvZiB0aGUgdXNlciBjYWxsaW5nIEl0ZXJhdG9yLnJlbW92ZSgpCiAgICAgKiBhZnRlciBoYXNOZXh0KCkgcmV0dXJuZWQgZmFsc2UuICBFdmVuIGluIHRoaXMgY2FzZSwgd2UgZW5zdXJlCiAgICAgKiB0aGF0IHdlIGRvbid0IHJlbW92ZSB0aGUgd3JvbmcgZWxlbWVudCBieSBrZWVwaW5nIHRyYWNrIG9mIHRoZQogICAgICogZXhwZWN0ZWQgZWxlbWVudCB0byByZW1vdmUsIGluIGxhc3RJdGVtLiAgWWVzLCB3ZSBtYXkgZmFpbCB0bwogICAgICogcmVtb3ZlIGxhc3RJdGVtIGZyb20gdGhlIHF1ZXVlIGlmIGl0IG1vdmVkIGR1ZSB0byBhbiBpbnRlcmxlYXZlZAogICAgICogaW50ZXJpb3IgcmVtb3ZlIHdoaWxlIGluIGRldGFjaGVkIG1vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgSXRyIGltcGxlbWVudHMgSXRlcmF0b3I8RT4gewogICAgICAgIC8qKiBJbmRleCB0byBsb29rIGZvciBuZXcgbmV4dEl0ZW07IE5PTkUgYXQgZW5kICovCiAgICAgICAgcHJpdmF0ZSBpbnQgY3Vyc29yOwoKICAgICAgICAvKiogRWxlbWVudCB0byBiZSByZXR1cm5lZCBieSBuZXh0IGNhbGwgdG8gbmV4dCgpOyBudWxsIGlmIG5vbmUgKi8KICAgICAgICBwcml2YXRlIEUgbmV4dEl0ZW07CgogICAgICAgIC8qKiBJbmRleCBvZiBuZXh0SXRlbTsgTk9ORSBpZiBub25lLCBSRU1PVkVEIGlmIHJlbW92ZWQgZWxzZXdoZXJlICovCiAgICAgICAgcHJpdmF0ZSBpbnQgbmV4dEluZGV4OwoKICAgICAgICAvKiogTGFzdCBlbGVtZW50IHJldHVybmVkOyBudWxsIGlmIG5vbmUgb3Igbm90IGRldGFjaGVkLiAqLwogICAgICAgIHByaXZhdGUgRSBsYXN0SXRlbTsKCiAgICAgICAgLyoqIEluZGV4IG9mIGxhc3RJdGVtLCBOT05FIGlmIG5vbmUsIFJFTU9WRUQgaWYgcmVtb3ZlZCBlbHNld2hlcmUgKi8KICAgICAgICBwcml2YXRlIGludCBsYXN0UmV0OwoKICAgICAgICAvKiogUHJldmlvdXMgdmFsdWUgb2YgdGFrZUluZGV4LCBvciBERVRBQ0hFRCB3aGVuIGRldGFjaGVkICovCiAgICAgICAgcHJpdmF0ZSBpbnQgcHJldlRha2VJbmRleDsKCiAgICAgICAgLyoqIFByZXZpb3VzIHZhbHVlIG9mIGl0ZXJzLmN5Y2xlcyAqLwogICAgICAgIHByaXZhdGUgaW50IHByZXZDeWNsZXM7CgogICAgICAgIC8qKiBTcGVjaWFsIGluZGV4IHZhbHVlIGluZGljYXRpbmcgIm5vdCBhdmFpbGFibGUiIG9yICJ1bmRlZmluZWQiICovCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE5PTkUgPSAtMTsKCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lhbCBpbmRleCB2YWx1ZSBpbmRpY2F0aW5nICJyZW1vdmVkIGVsc2V3aGVyZSIsIHRoYXQgaXMsCiAgICAgICAgICogcmVtb3ZlZCBieSBzb21lIG9wZXJhdGlvbiBvdGhlciB0aGFuIGEgY2FsbCB0byB0aGlzLnJlbW92ZSgpLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBSRU1PVkVEID0gLTI7CgogICAgICAgIC8qKiBTcGVjaWFsIHZhbHVlIGZvciBwcmV2VGFrZUluZGV4IGluZGljYXRpbmcgImRldGFjaGVkIG1vZGUiICovCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IERFVEFDSEVEID0gLTM7CgogICAgICAgIEl0cigpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMDsKICAgICAgICAgICAgbGFzdFJldCA9IE5PTkU7CiAgICAgICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS50aGlzLmxvY2s7CiAgICAgICAgICAgIGxvY2subG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgaXRycyA9PSBudWxsOwogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IE5PTkU7CiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gTk9ORTsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFrZUluZGV4ID0gREVUQUNIRUQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIGludCB0YWtlSW5kZXggPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy50YWtlSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgcHJldlRha2VJbmRleCA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbSA9IGl0ZW1BdChuZXh0SW5kZXggPSB0YWtlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IGluY0N1cnNvcih0YWtlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGlmIChpdHJzID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRycyA9IG5ldyBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycyh0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpdHJzLnJlZ2lzdGVyKHRoaXMpOyAvLyBpbiB0aGlzIG9yZGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMuZG9Tb21lU3dlZXBpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwcmV2Q3ljbGVzID0gaXRycy5jeWNsZXM7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IHRha2VJbmRleCA+PSAwOwogICAgICAgICAgICAgICAgICAgIC8vIGFzc2VydCBwcmV2VGFrZUluZGV4ID09IHRha2VJbmRleDsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgbmV4dEluZGV4ID49IDA7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IG5leHRJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGlzRGV0YWNoZWQoKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDE7CiAgICAgICAgICAgIHJldHVybiBwcmV2VGFrZUluZGV4IDwgMDsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IGluY0N1cnNvcihpbnQgaW5kZXgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaWYgKCsraW5kZXggPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICBpZiAoaW5kZXggPT0gcHV0SW5kZXgpCiAgICAgICAgICAgICAgICBpbmRleCA9IE5PTkU7CiAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiBpbmRleCBpcyBpbnZhbGlkYXRlZCBieSB0aGUgZ2l2ZW4gbnVtYmVyIG9mCiAgICAgICAgICogZGVxdWV1ZXMsIHN0YXJ0aW5nIGZyb20gcHJldlRha2VJbmRleC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIGJvb2xlYW4gaW52YWxpZGF0ZWQoaW50IGluZGV4LCBpbnQgcHJldlRha2VJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBkZXF1ZXVlcywgaW50IGxlbmd0aCkgewogICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpbnQgZGlzdGFuY2UgPSBpbmRleCAtIHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDApCiAgICAgICAgICAgICAgICBkaXN0YW5jZSArPSBsZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBkZXF1ZXVlcyA+IGRpc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRqdXN0cyBpbmRpY2VzIHRvIGluY29ycG9yYXRlIGFsbCBkZXF1ZXVlcyBzaW5jZSB0aGUgbGFzdAogICAgICAgICAqIG9wZXJhdGlvbiBvbiB0aGlzIGl0ZXJhdG9yLiAgQ2FsbCBvbmx5IGZyb20gaXRlcmF0aW5nIHRocmVhZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaW5jb3Jwb3JhdGVEZXF1ZXVlcygpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgLy8gYXNzZXJ0IGl0cnMgIT0gbnVsbDsKICAgICAgICAgICAgLy8gYXNzZXJ0ICFpc0RldGFjaGVkKCk7CiAgICAgICAgICAgIC8vIGFzc2VydCBjb3VudCA+IDA7CgogICAgICAgICAgICBmaW5hbCBpbnQgY3ljbGVzID0gaXRycy5jeWNsZXM7CiAgICAgICAgICAgIGZpbmFsIGludCB0YWtlSW5kZXggPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy50YWtlSW5kZXg7CiAgICAgICAgICAgIGZpbmFsIGludCBwcmV2Q3ljbGVzID0gdGhpcy5wcmV2Q3ljbGVzOwogICAgICAgICAgICBmaW5hbCBpbnQgcHJldlRha2VJbmRleCA9IHRoaXMucHJldlRha2VJbmRleDsKCiAgICAgICAgICAgIGlmIChjeWNsZXMgIT0gcHJldkN5Y2xlcyB8fCB0YWtlSW5kZXggIT0gcHJldlRha2VJbmRleCkgewogICAgICAgICAgICAgICAgZmluYWwgaW50IGxlbiA9IGl0ZW1zLmxlbmd0aDsKICAgICAgICAgICAgICAgIC8vIGhvdyBmYXIgdGFrZUluZGV4IGhhcyBhZHZhbmNlZCBzaW5jZSB0aGUgcHJldmlvdXMKICAgICAgICAgICAgICAgIC8vIG9wZXJhdGlvbiBvZiB0aGlzIGl0ZXJhdG9yCiAgICAgICAgICAgICAgICBsb25nIGRlcXVldWVzID0gKGN5Y2xlcyAtIHByZXZDeWNsZXMpICogbGVuCiAgICAgICAgICAgICAgICAgICAgICAgICsgKHRha2VJbmRleCAtIHByZXZUYWtlSW5kZXgpOwoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGluZGljZXMgZm9yIGludmFsaWRhdGlvbgogICAgICAgICAgICAgICAgaWYgKGludmFsaWRhdGVkKGxhc3RSZXQsIHByZXZUYWtlSW5kZXgsIGRlcXVldWVzLCBsZW4pKQogICAgICAgICAgICAgICAgICAgIGxhc3RSZXQgPSBSRU1PVkVEOwogICAgICAgICAgICAgICAgaWYgKGludmFsaWRhdGVkKG5leHRJbmRleCwgcHJldlRha2VJbmRleCwgZGVxdWV1ZXMsIGxlbikpCiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gUkVNT1ZFRDsKICAgICAgICAgICAgICAgIGlmIChpbnZhbGlkYXRlZChjdXJzb3IsIHByZXZUYWtlSW5kZXgsIGRlcXVldWVzLCBsZW4pKQogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IHRha2VJbmRleDsKCiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yIDwgMCAmJiBuZXh0SW5kZXggPCAwICYmIGxhc3RSZXQgPCAwKQogICAgICAgICAgICAgICAgICAgIGRldGFjaCgpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2Q3ljbGVzID0gY3ljbGVzOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJldlRha2VJbmRleCA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbGVkIHdoZW4gaXRycyBzaG91bGQgc3RvcCB0cmFja2luZyB0aGlzIGl0ZXJhdG9yLCBlaXRoZXIKICAgICAgICAgKiBiZWNhdXNlIHRoZXJlIGFyZSBubyBtb3JlIGluZGljZXMgdG8gdXBkYXRlIChjdXJzb3IgPCAwICYmCiAgICAgICAgICogbmV4dEluZGV4IDwgMCAmJiBsYXN0UmV0IDwgMCkgb3IgYXMgYSBzcGVjaWFsIGV4Y2VwdGlvbiwgd2hlbgogICAgICAgICAqIGxhc3RSZXQgPj0gMCwgYmVjYXVzZSBoYXNOZXh0KCkgaXMgYWJvdXQgdG8gcmV0dXJuIGZhbHNlIGZvciB0aGUKICAgICAgICAgKiBmaXJzdCB0aW1lLiAgQ2FsbCBvbmx5IGZyb20gaXRlcmF0aW5nIHRocmVhZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNoKCkgewogICAgICAgICAgICAvLyBTd2l0Y2ggdG8gZGV0YWNoZWQgbW9kZQogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICAvLyBhc3NlcnQgY3Vyc29yID09IE5PTkU7CiAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggPCAwOwogICAgICAgICAgICAvLyBhc3NlcnQgbGFzdFJldCA8IDAgfHwgbmV4dEl0ZW0gPT0gbnVsbDsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPCAwIF4gbGFzdEl0ZW0gIT0gbnVsbDsKICAgICAgICAgICAgaWYgKHByZXZUYWtlSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGl0cnMgIT0gbnVsbDsKICAgICAgICAgICAgICAgIHByZXZUYWtlSW5kZXggPSBERVRBQ0hFRDsKICAgICAgICAgICAgICAgIC8vIHRyeSB0byB1bmxpbmsgZnJvbSBpdHJzIChidXQgbm90IHRvbyBoYXJkKQogICAgICAgICAgICAgICAgaXRycy5kb1NvbWVTd2VlcGluZyh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMsIHdlIHdvdWxkIGxpa2Ugbm90IHRvIGFjcXVpcmUgYSBsb2NrIGluCiAgICAgICAgICogaGFzTmV4dCBpbiB0aGUgY29tbW9uIGNhc2UuICBUbyBhbGxvdyBmb3IgdGhpcywgd2Ugb25seSBhY2Nlc3MKICAgICAgICAgKiBmaWVsZHMgKGkuZS4gbmV4dEl0ZW0pIHRoYXQgYXJlIG5vdCBtb2RpZmllZCBieSB1cGRhdGUgb3BlcmF0aW9ucwogICAgICAgICAqIHRyaWdnZXJlZCBieSBxdWV1ZSBtb2RpZmljYXRpb25zLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDA7CiAgICAgICAgICAgIGlmIChuZXh0SXRlbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIG5vTmV4dCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgbm9OZXh0KCkgewogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBjdXJzb3IgPT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggPT0gTk9ORTsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPj0gMDsKICAgICAgICAgICAgICAgICAgICBpbmNvcnBvcmF0ZURlcXVldWVzKCk7IC8vIG1pZ2h0IHVwZGF0ZSBsYXN0UmV0CiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RSZXQgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0SXRlbSA9IGl0ZW1BdChsYXN0UmV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGFzc2VydCBpc0RldGFjaGVkKCk7CiAgICAgICAgICAgICAgICAvLyBhc3NlcnQgbGFzdFJldCA8IDAgXiBsYXN0SXRlbSAhPSBudWxsOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIEUgbmV4dCgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMDsKICAgICAgICAgICAgZmluYWwgRSB4ID0gbmV4dEl0ZW07CiAgICAgICAgICAgIGlmICh4ID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9TdWNoRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIGluY29ycG9yYXRlRGVxdWV1ZXMoKTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggIT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBsYXN0SXRlbSA9PSBudWxsOwogICAgICAgICAgICAgICAgbGFzdFJldCA9IG5leHRJbmRleDsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBjdXJzb3IgPSB0aGlzLmN1cnNvcjsKICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIG5leHRJdGVtID0gaXRlbUF0KG5leHRJbmRleCA9IGN1cnNvcik7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IG5leHRJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJzb3IgPSBpbmNDdXJzb3IoY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gTk9ORTsKICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAwOwogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIGluY29ycG9yYXRlRGVxdWV1ZXMoKTsgLy8gbWlnaHQgdXBkYXRlIGxhc3RSZXQgb3IgZGV0YWNoCiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgbGFzdFJldCA9IHRoaXMubGFzdFJldDsKICAgICAgICAgICAgICAgIHRoaXMubGFzdFJldCA9IE5PTkU7CiAgICAgICAgICAgICAgICBpZiAobGFzdFJldCA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0KGxhc3RSZXQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBFIGxhc3RJdGVtID0gdGhpcy5sYXN0SXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdEl0ZW0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUF0KGxhc3RSZXQpID09IGxhc3RJdGVtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXQobGFzdFJldCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsYXN0UmV0ID09IE5PTkUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgLy8gZWxzZSBsYXN0UmV0ID09IFJFTU9WRUQgYW5kIHRoZSBsYXN0IHJldHVybmVkIGVsZW1lbnQgd2FzCiAgICAgICAgICAgICAgICAvLyBwcmV2aW91c2x5IGFzeW5jaHJvbm91c2x5IHJlbW92ZWQgdmlhIGFuIG9wZXJhdGlvbiBvdGhlcgogICAgICAgICAgICAgICAgLy8gdGhhbiB0aGlzLnJlbW92ZSgpLCBzbyBub3RoaW5nIHRvIGRvLgoKICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPCAwICYmIG5leHRJbmRleCA8IDApCiAgICAgICAgICAgICAgICAgICAgZGV0YWNoKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBsYXN0SXRlbSA9PSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgdG8gbm90aWZ5IHRoZSBpdGVyYXRvciB0aGF0IHRoZSBxdWV1ZSBpcyBlbXB0eSwgb3IgdGhhdCBpdAogICAgICAgICAqIGhhcyBmYWxsZW4gaG9wZWxlc3NseSBiZWhpbmQsIHNvIHRoYXQgaXQgc2hvdWxkIGFiYW5kb24gYW55CiAgICAgICAgICogZnVydGhlciBpdGVyYXRpb24sIGV4Y2VwdCBwb3NzaWJseSB0byByZXR1cm4gb25lIG1vcmUgZWxlbWVudAogICAgICAgICAqIGZyb20gbmV4dCgpLCBhcyBwcm9taXNlZCBieSByZXR1cm5pbmcgdHJ1ZSBmcm9tIGhhc05leHQoKS4KICAgICAgICAgKi8KICAgICAgICB2b2lkIHNodXRkb3duKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBjdXJzb3IgPSBOT05FOwogICAgICAgICAgICBpZiAobmV4dEluZGV4ID49IDApCiAgICAgICAgICAgICAgICBuZXh0SW5kZXggPSBSRU1PVkVEOwogICAgICAgICAgICBpZiAobGFzdFJldCA+PSAwKSB7CiAgICAgICAgICAgICAgICBsYXN0UmV0ID0gUkVNT1ZFRDsKICAgICAgICAgICAgICAgIGxhc3RJdGVtID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmV2VGFrZUluZGV4ID0gREVUQUNIRUQ7CiAgICAgICAgICAgIC8vIERvbid0IHNldCBuZXh0SXRlbSB0byBudWxsIGJlY2F1c2Ugd2UgbXVzdCBjb250aW51ZSB0byBiZQogICAgICAgICAgICAvLyBhYmxlIHRvIHJldHVybiBpdCBvbiBuZXh0KCkuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIENhbGxlciB3aWxsIHVubGluayBmcm9tIGl0cnMgd2hlbiBjb252ZW5pZW50LgogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgZGlzdGFuY2UoaW50IGluZGV4LCBpbnQgcHJldlRha2VJbmRleCwgaW50IGxlbmd0aCkgewogICAgICAgICAgICBpbnQgZGlzdGFuY2UgPSBpbmRleCAtIHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDApCiAgICAgICAgICAgICAgICBkaXN0YW5jZSArPSBsZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBkaXN0YW5jZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciBhbiBpbnRlcmlvciByZW1vdmUgKG5vdCBhdCB0YWtlSW5kZXgpIG9jY3VycmVkLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgaXRlcmF0b3Igc2hvdWxkIGJlIHVubGlua2VkIGZyb20gaXRycwogICAgICAgICAqLwogICAgICAgIGJvb2xlYW4gcmVtb3ZlZEF0KGludCByZW1vdmVkSW5kZXgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaWYgKGlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgZmluYWwgaW50IGN5Y2xlcyA9IGl0cnMuY3ljbGVzOwogICAgICAgICAgICBmaW5hbCBpbnQgdGFrZUluZGV4ID0gamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLnRoaXMudGFrZUluZGV4OwogICAgICAgICAgICBmaW5hbCBpbnQgcHJldkN5Y2xlcyA9IHRoaXMucHJldkN5Y2xlczsKICAgICAgICAgICAgZmluYWwgaW50IHByZXZUYWtlSW5kZXggPSB0aGlzLnByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGZpbmFsIGludCBsZW4gPSBpdGVtcy5sZW5ndGg7CiAgICAgICAgICAgIGludCBjeWNsZURpZmYgPSBjeWNsZXMgLSBwcmV2Q3ljbGVzOwogICAgICAgICAgICBpZiAocmVtb3ZlZEluZGV4IDwgdGFrZUluZGV4KQogICAgICAgICAgICAgICAgY3ljbGVEaWZmKys7CiAgICAgICAgICAgIGZpbmFsIGludCByZW1vdmVkRGlzdGFuY2UgPQogICAgICAgICAgICAgICAgICAgIChjeWNsZURpZmYgKiBsZW4pICsgKHJlbW92ZWRJbmRleCAtIHByZXZUYWtlSW5kZXgpOwogICAgICAgICAgICAvLyBhc3NlcnQgcmVtb3ZlZERpc3RhbmNlID49IDA7CiAgICAgICAgICAgIGludCBjdXJzb3IgPSB0aGlzLmN1cnNvcjsKICAgICAgICAgICAgaWYgKGN1cnNvciA+PSAwKSB7CiAgICAgICAgICAgICAgICBpbnQgeCA9IGRpc3RhbmNlKGN1cnNvciwgcHJldlRha2VJbmRleCwgbGVuKTsKICAgICAgICAgICAgICAgIGlmICh4ID09IHJlbW92ZWREaXN0YW5jZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPT0gcHV0SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3Vyc29yID0gY3Vyc29yID0gTk9ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHggPiByZW1vdmVkRGlzdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgY3Vyc29yICE9IHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJzb3IgPSBjdXJzb3IgPSBkZWMoY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpbnQgbGFzdFJldCA9IHRoaXMubGFzdFJldDsKICAgICAgICAgICAgaWYgKGxhc3RSZXQgPj0gMCkgewogICAgICAgICAgICAgICAgaW50IHggPSBkaXN0YW5jZShsYXN0UmV0LCBwcmV2VGFrZUluZGV4LCBsZW4pOwogICAgICAgICAgICAgICAgaWYgKHggPT0gcmVtb3ZlZERpc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFJldCA9IGxhc3RSZXQgPSBSRU1PVkVEOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoeCA+IHJlbW92ZWREaXN0YW5jZSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RSZXQgPSBsYXN0UmV0ID0gZGVjKGxhc3RSZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGludCBuZXh0SW5kZXggPSB0aGlzLm5leHRJbmRleDsKICAgICAgICAgICAgaWYgKG5leHRJbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgICBpbnQgeCA9IGRpc3RhbmNlKG5leHRJbmRleCwgcHJldlRha2VJbmRleCwgbGVuKTsKICAgICAgICAgICAgICAgIGlmICh4ID09IHJlbW92ZWREaXN0YW5jZSkKICAgICAgICAgICAgICAgICAgICB0aGlzLm5leHRJbmRleCA9IG5leHRJbmRleCA9IFJFTU9WRUQ7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh4ID4gcmVtb3ZlZERpc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dEluZGV4ID0gbmV4dEluZGV4ID0gZGVjKG5leHRJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY3Vyc29yIDwgMCAmJiBuZXh0SW5kZXggPCAwICYmIGxhc3RSZXQgPCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnByZXZUYWtlSW5kZXggPSBERVRBQ0hFRDsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciB0YWtlSW5kZXggd3JhcHMgYXJvdW5kIHRvIHplcm8uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhpcyBpdGVyYXRvciBzaG91bGQgYmUgdW5saW5rZWQgZnJvbSBpdHJzCiAgICAgICAgICovCiAgICAgICAgYm9vbGVhbiB0YWtlSW5kZXhXcmFwcGVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBpZiAoaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChpdHJzLmN5Y2xlcyAtIHByZXZDeWNsZXMgPiAxKSB7CiAgICAgICAgICAgICAgICAvLyBBbGwgdGhlIGVsZW1lbnRzIHRoYXQgZXhpc3RlZCBhdCB0aGUgdGltZSBvZiB0aGUgbGFzdAogICAgICAgICAgICAgICAgLy8gb3BlcmF0aW9uIGFyZSBnb25lLCBzbyBhYmFuZG9uIGZ1cnRoZXIgaXRlcmF0aW9uLgogICAgICAgICAgICAgICAgc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgovLyAgICAgICAgIC8qKiBVbmNvbW1lbnQgZm9yIGRlYnVnZ2luZy4gKi8KLy8gICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewovLyAgICAgICAgICAgICByZXR1cm4gKCJjdXJzb3I9IiArIGN1cnNvciArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgIm5leHRJbmRleD0iICsgbmV4dEluZGV4ICsgIiAiICsKLy8gICAgICAgICAgICAgICAgICAgICAibGFzdFJldD0iICsgbGFzdFJldCArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgIm5leHRJdGVtPSIgKyBuZXh0SXRlbSArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgImxhc3RJdGVtPSIgKyBsYXN0SXRlbSArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgInByZXZDeWNsZXM9IiArIHByZXZDeWNsZXMgKyAiICIgKwovLyAgICAgICAgICAgICAgICAgICAgICJwcmV2VGFrZUluZGV4PSIgKyBwcmV2VGFrZUluZGV4ICsgIiAiICsKLy8gICAgICAgICAgICAgICAgICAgICAic2l6ZSgpPSIgKyBzaXplKCkgKyAiICIgKwovLyAgICAgICAgICAgICAgICAgICAgICJyZW1haW5pbmdDYXBhY2l0eSgpPSIgKyByZW1haW5pbmdDYXBhY2l0eSgpKTsKLy8gICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEge0BsaW5rIFNwbGl0ZXJhdG9yfSBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlLgogICAgICoKICAgICAqIDxwPlRoZSByZXR1cm5lZCBzcGxpdGVyYXRvciBpcwogICAgICogPGEgaHJlZj0icGFja2FnZS1zdW1tYXJ5Lmh0bWwjV2Vha2x5Ij48aT53ZWFrbHkgY29uc2lzdGVudDwvaT48L2E+LgogICAgICoKICAgICAqIDxwPlRoZSB7QGNvZGUgU3BsaXRlcmF0b3J9IHJlcG9ydHMge0BsaW5rIFNwbGl0ZXJhdG9yI0NPTkNVUlJFTlR9LAogICAgICoge0BsaW5rIFNwbGl0ZXJhdG9yI09SREVSRUR9LCBhbmQge0BsaW5rIFNwbGl0ZXJhdG9yI05PTk5VTEx9LgogICAgICoKICAgICAqIEBpbXBsTm90ZQogICAgICogVGhlIHtAY29kZSBTcGxpdGVyYXRvcn0gaW1wbGVtZW50cyB7QGNvZGUgdHJ5U3BsaXR9IHRvIHBlcm1pdCBsaW1pdGVkCiAgICAgKiBwYXJhbGxlbGlzbS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGEge0Bjb2RlIFNwbGl0ZXJhdG9yfSBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlCiAgICAgKiBAc2luY2UgMS44CiAgICAgKi8KICAgIHB1YmxpYyBTcGxpdGVyYXRvcjxFPiBzcGxpdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gU3BsaXRlcmF0b3JzLnNwbGl0ZXJhdG9yCiAgICAgICAgICAgICAgICAodGhpcywgU3BsaXRlcmF0b3IuT1JERVJFRCB8IFNwbGl0ZXJhdG9yLk5PTk5VTEwgfAogICAgICAgICAgICAgICAgICAgICAgICBTcGxpdGVyYXRvci5DT05DVVJSRU5UKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlc2VyaWFsaXplcyB0aGlzIHF1ZXVlIGFuZCB0aGVuIGNoZWNrcyBzb21lIGludmFyaWFudHMuCiAgICAgKgogICAgICogQHBhcmFtIHMgdGhlIGlucHV0IHN0cmVhbQogICAgICogQHRocm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGlmIHRoZSBjbGFzcyBvZiBhIHNlcmlhbGl6ZWQgb2JqZWN0CiAgICAgKiAgICAgICAgIGNvdWxkIG5vdCBiZSBmb3VuZAogICAgICogQHRocm93cyBqYXZhLmlvLkludmFsaWRPYmplY3RFeGNlcHRpb24gaWYgaW52YXJpYW50cyBhcmUgdmlvbGF0ZWQKICAgICAqIEB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiBpZiBhbiBJL08gZXJyb3Igb2NjdXJzCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0KGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW0gcykKICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewoKICAgICAgICAvLyBSZWFkIGluIGl0ZW1zIGFycmF5IGFuZCB2YXJpb3VzIGZpZWxkcwogICAgICAgIHMuZGVmYXVsdFJlYWRPYmplY3QoKTsKCiAgICAgICAgLy8gQ2hlY2sgaW52YXJpYW50cyBvdmVyIGNvdW50IGFuZCBpbmRleCBmaWVsZHMuIE5vdGUgdGhhdAogICAgICAgIC8vIGlmIHB1dEluZGV4PT10YWtlSW5kZXgsIGNvdW50IGNhbiBiZSBlaXRoZXIgMCBvciBpdGVtcy5sZW5ndGguCiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PSAwIHx8CiAgICAgICAgICAgICAgICB0YWtlSW5kZXggPCAwIHx8IHRha2VJbmRleCA+PSBpdGVtcy5sZW5ndGggfHwKICAgICAgICAgICAgICAgIHB1dEluZGV4ICA8IDAgfHwgcHV0SW5kZXggID49IGl0ZW1zLmxlbmd0aCB8fAogICAgICAgICAgICAgICAgY291bnQgPCAwICAgICB8fCBjb3VudCAgICAgPiAgaXRlbXMubGVuZ3RoIHx8CiAgICAgICAgICAgICAgICBNYXRoLmZsb29yTW9kKHB1dEluZGV4IC0gdGFrZUluZGV4LCBpdGVtcy5sZW5ndGgpICE9CiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3JNb2QoY291bnQsIGl0ZW1zLmxlbmd0aCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IGphdmEuaW8uSW52YWxpZE9iamVjdEV4Y2VwdGlvbigiaW52YXJpYW50cyB2aW9sYXRlZCIpOwogICAgICAgIH0KICAgIH0KfQo=</text>
      </register>
      <register name="-" type="4">
        <text>&quot;Argument was %s but expected nonnegative&quot;);</text>
      </register>
      <register name="/" type="4">
        <text>countr</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">ICAgICAgICBjaGVja0FyZ3VtZW50KGE+MCwiQXJndW1lbnQgd2FzICVzIGJ1dCBleHBlY3RlZCBub25uZWdhdGl2ZSIsIGEpOwo=</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgIGZpbmFsIGludCBkZWMoaW50IGkpIHsKICAgICAgICByZXR1cm4gKChpID09IDApID8gaXRlbXMubGVuZ3RoIDogaSkgLSAxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBpdGVtIGF0IGluZGV4IGkuCiAgICAgKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgZmluYWwgRSBpdGVtQXQoaW50IGkpIHsKICAgICAgICByZXR1cm4gKEUpIGl0ZW1zW2ldOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIGFyZ3VtZW50IGlzIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIHYgdGhlIGVsZW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBjaGVja05vdE51bGwoT2JqZWN0IHYpIHsKICAgICAgICBpZiAodiA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydHMgZWxlbWVudCBhdCBjdXJyZW50IHB1dCBwb3NpdGlvbiwgYWR2YW5jZXMsIGFuZCBzaWduYWxzLgogICAgICogQ2FsbCBvbmx5IHdoZW4gaG9sZGluZyBsb2NrLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5xdWV1ZShFIHgpIHsKICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgIC8vIGFzc2VydCBpdGVtc1twdXRJbmRleF0gPT0gbnVsbDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgaXRlbXNbcHV0SW5kZXhdID0geDsKICAgICAgICBpZiAoKytwdXRJbmRleCA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgIHB1dEluZGV4ID0gMDsKICAgICAgICBjb3VudCsrOwogICAgICAgIG5vdEVtcHR5LnNpZ25hbCgpOwogICAgfQoKICAgIC8qKgogICAgICogRXh0cmFjdHMgZWxlbWVudCBhdCBjdXJyZW50IHRha2UgcG9zaXRpb24sIGFkdmFuY2VzLCBhbmQgc2lnbmFscy4KICAgICAqIENhbGwgb25seSB3aGVuIGhvbGRpbmcgbG9jay4KICAgICAqLwogICAgcHJpdmF0ZSBFIGRlcXVldWUoKSB7CiAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAvLyBhc3NlcnQgaXRlbXNbdGFrZUluZGV4XSAhPSBudWxsOwogICAgICAgIGZpbmFsIE9iamVjdFtdIGl0ZW1zID0gdGhpcy5pdGVtczsKICAgICAgICBAU3VwcHJlc3NXYXJuaW5ncygidW5jaGVja2VkIikKICAgICAgICBFIHggPSAoRSkgaXRlbXNbdGFrZUluZGV4XTsKICAgICAgICBpdGVtc1t0YWtlSW5kZXhdID0gbnVsbDsKICAgICAgICBpZiAoKyt0YWtlSW5kZXggPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICB0YWtlSW5kZXggPSAwOwogICAgICAgIGNvdW50LS07CiAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgaXRycy5lbGVtZW50RGVxdWV1ZWQoKTsKICAgICAgICBub3RGdWxsLnNpZ25hbCgpOwogICAgICAgIHJldHVybiB4OwogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlcyBpdGVtIGF0IGFycmF5IGluZGV4IHJlbW92ZUluZGV4LgogICAgICogVXRpbGl0eSBmb3IgcmVtb3ZlKE9iamVjdCkgYW5kIGl0ZXJhdG9yLnJlbW92ZS4KICAgICAqIENhbGwgb25seSB3aGVuIGhvbGRpbmcgbG9jay4KICAgICAqLwogICAgdm9pZCByZW1vdmVBdChmaW5hbCBpbnQgcmVtb3ZlSW5kZXgpIHsKICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgIC8vIGFzc2VydCBpdGVtc1tyZW1vdmVJbmRleF0gIT0gbnVsbDsKICAgICAgICAvLyBhc3NlcnQgcmVtb3ZlSW5kZXggPj0gMCAmJiByZW1vdmVJbmRleCA8IGl0ZW1zLmxlbmd0aDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgaWYgKHJlbW92ZUluZGV4ID09IHRha2VJbmRleCkgewogICAgICAgICAgICAvLyByZW1vdmluZyBmcm9udCBpdGVtOyBqdXN0IGFkdmFuY2UKICAgICAgICAgICAgaXRlbXNbdGFrZUluZGV4XSA9IG51bGw7CiAgICAgICAgICAgIGlmICgrK3Rha2VJbmRleCA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0YWtlSW5kZXggPSAwOwogICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgICBpZiAoaXRycyAhPSBudWxsKQogICAgICAgICAgICAgICAgaXRycy5lbGVtZW50RGVxdWV1ZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBhbiAiaW50ZXJpb3IiIHJlbW92ZQoKICAgICAgICAgICAgLy8gc2xpZGUgb3ZlciBhbGwgb3RoZXJzIHVwIHRocm91Z2ggcHV0SW5kZXguCiAgICAgICAgICAgIGZpbmFsIGludCBwdXRJbmRleCA9IHRoaXMucHV0SW5kZXg7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSByZW1vdmVJbmRleDs7KSB7CiAgICAgICAgICAgICAgICBpbnQgbmV4dCA9IGkgKyAxOwogICAgICAgICAgICAgICAgaWYgKG5leHQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIG5leHQgPSAwOwogICAgICAgICAgICAgICAgaWYgKG5leHQgIT0gcHV0SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXSA9IGl0ZW1zW25leHRdOwogICAgICAgICAgICAgICAgICAgIGkgPSBuZXh0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXRJbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY291bnQtLTsKICAgICAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGl0cnMucmVtb3ZlZEF0KHJlbW92ZUluZGV4KTsKICAgICAgICB9CiAgICAgICAgbm90RnVsbC5zaWduYWwoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4ge0Bjb2RlIEFycmF5QmxvY2tpbmdRdWV1ZX0gd2l0aCB0aGUgZ2l2ZW4gKGZpeGVkKQogICAgICogY2FwYWNpdHkgYW5kIGRlZmF1bHQgYWNjZXNzIHBvbGljeS4KICAgICAqCiAgICAgKiBAcGFyYW0gY2FwYWNpdHkgdGhlIGNhcGFjaXR5IG9mIHRoaXMgcXVldWUKICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBjYXBhY2l0eSA8IDF9CiAgICAgKi8KICAgIHB1YmxpYyBBcnJheUJsb2NraW5nUXVldWUoaW50IGNhcGFjaXR5KSB7CiAgICAgICAgdGhpcyhjYXBhY2l0eSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhbiB7QGNvZGUgQXJyYXlCbG9ja2luZ1F1ZXVlfSB3aXRoIHRoZSBnaXZlbiAoZml4ZWQpCiAgICAgKiBjYXBhY2l0eSBhbmQgdGhlIHNwZWNpZmllZCBhY2Nlc3MgcG9saWN5LgogICAgICoKICAgICAqIEBwYXJhbSBjYXBhY2l0eSB0aGUgY2FwYWNpdHkgb2YgdGhpcyBxdWV1ZQogICAgICogQHBhcmFtIGZhaXIgaWYge0Bjb2RlIHRydWV9IHRoZW4gcXVldWUgYWNjZXNzZXMgZm9yIHRocmVhZHMgYmxvY2tlZAogICAgICogICAgICAgIG9uIGluc2VydGlvbiBvciByZW1vdmFsLCBhcmUgcHJvY2Vzc2VkIGluIEZJRk8gb3JkZXI7CiAgICAgKiAgICAgICAgaWYge0Bjb2RlIGZhbHNlfSB0aGUgYWNjZXNzIG9yZGVyIGlzIHVuc3BlY2lmaWVkLgogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYge0Bjb2RlIGNhcGFjaXR5IDwgMX0KICAgICAqLwogICAgcHVibGljIEFycmF5QmxvY2tpbmdRdWV1ZShpbnQgY2FwYWNpdHksIGJvb2xlYW4gZmFpcikgewogICAgICAgIGlmIChjYXBhY2l0eSA8PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgdGhpcy5pdGVtcyA9IG5ldyBPYmplY3RbY2FwYWNpdHldOwogICAgICAgIGxvY2sgPSBuZXcgUmVlbnRyYW50TG9jayhmYWlyKTsKICAgICAgICBub3RFbXB0eSA9IGxvY2submV3Q29uZGl0aW9uKCk7CiAgICAgICAgbm90RnVsbCA9ICBsb2NrLm5ld0NvbmRpdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhbiB7QGNvZGUgQXJyYXlCbG9ja2luZ1F1ZXVlfSB3aXRoIHRoZSBnaXZlbiAoZml4ZWQpCiAgICAgKiBjYXBhY2l0eSwgdGhlIHNwZWNpZmllZCBhY2Nlc3MgcG9saWN5IGFuZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUKICAgICAqIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBjb2xsZWN0aW9uLAogICAgICogYWRkZWQgaW4gdHJhdmVyc2FsIG9yZGVyIG9mIHRoZSBjb2xsZWN0aW9uJ3MgaXRlcmF0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGNhcGFjaXR5IHRoZSBjYXBhY2l0eSBvZiB0aGlzIHF1ZXVlCiAgICAgKiBAcGFyYW0gZmFpciBpZiB7QGNvZGUgdHJ1ZX0gdGhlbiBxdWV1ZSBhY2Nlc3NlcyBmb3IgdGhyZWFkcyBibG9ja2VkCiAgICAgKiAgICAgICAgb24gaW5zZXJ0aW9uIG9yIHJlbW92YWwsIGFyZSBwcm9jZXNzZWQgaW4gRklGTyBvcmRlcjsKICAgICAqICAgICAgICBpZiB7QGNvZGUgZmFsc2V9IHRoZSBhY2Nlc3Mgb3JkZXIgaXMgdW5zcGVjaWZpZWQuCiAgICAgKiBAcGFyYW0gYyB0aGUgY29sbGVjdGlvbiBvZiBlbGVtZW50cyB0byBpbml0aWFsbHkgY29udGFpbgogICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYge0Bjb2RlIGNhcGFjaXR5fSBpcyBsZXNzIHRoYW4KICAgICAqICAgICAgICAge0Bjb2RlIGMuc2l6ZSgpfSwgb3IgbGVzcyB0aGFuIDEuCiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBvciBhbnkKICAgICAqICAgICAgICAgb2YgaXRzIGVsZW1lbnRzIGFyZSBudWxsCiAgICAgKi8KICAgIHB1YmxpYyBBcnJheUJsb2NraW5nUXVldWUoaW50IGNhcGFjaXR5LCBib29sZWFuIGZhaXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbGxlY3Rpb248PyBleHRlbmRzIEU+IGMpIHsKICAgICAgICB0aGlzKGNhcGFjaXR5LCBmYWlyKTsKCiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOyAvLyBMb2NrIG9ubHkgZm9yIHZpc2liaWxpdHksIG5vdCBtdXR1YWwgZXhjbHVzaW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChFIGUgOiBjKSB7CiAgICAgICAgICAgICAgICAgICAgY2hlY2tOb3ROdWxsKGUpOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zW2krK10gPSBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3VudCA9IGk7CiAgICAgICAgICAgIHB1dEluZGV4ID0gKGkgPT0gY2FwYWNpdHkpID8gMCA6IGk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnNlcnRzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBhdCB0aGUgdGFpbCBvZiB0aGlzIHF1ZXVlIGlmIGl0IGlzCiAgICAgKiBwb3NzaWJsZSB0byBkbyBzbyBpbW1lZGlhdGVseSB3aXRob3V0IGV4Y2VlZGluZyB0aGUgcXVldWUncyBjYXBhY2l0eSwKICAgICAqIHJldHVybmluZyB7QGNvZGUgdHJ1ZX0gdXBvbiBzdWNjZXNzIGFuZCB0aHJvd2luZyBhbgogICAgICoge0Bjb2RlIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbn0gaWYgdGhpcyBxdWV1ZSBpcyBmdWxsLgogICAgICoKICAgICAqIEBwYXJhbSBlIHRoZSBlbGVtZW50IHRvIGFkZAogICAgICogQHJldHVybiB7QGNvZGUgdHJ1ZX0gKGFzIHNwZWNpZmllZCBieSB7QGxpbmsgQ29sbGVjdGlvbiNhZGR9KQogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaWYgdGhpcyBxdWV1ZSBpcyBmdWxsCiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIGlmIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBpcyBudWxsCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZChFIGUpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYWRkKGUpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSBpZiBpdCBpcwogICAgICogcG9zc2libGUgdG8gZG8gc28gaW1tZWRpYXRlbHkgd2l0aG91dCBleGNlZWRpbmcgdGhlIHF1ZXVlJ3MgY2FwYWNpdHksCiAgICAgKiByZXR1cm5pbmcge0Bjb2RlIHRydWV9IHVwb24gc3VjY2VzcyBhbmQge0Bjb2RlIGZhbHNlfSBpZiB0aGlzIHF1ZXVlCiAgICAgKiBpcyBmdWxsLiAgVGhpcyBtZXRob2QgaXMgZ2VuZXJhbGx5IHByZWZlcmFibGUgdG8gbWV0aG9kIHtAbGluayAjYWRkfSwKICAgICAqIHdoaWNoIGNhbiBmYWlsIHRvIGluc2VydCBhbiBlbGVtZW50IG9ubHkgYnkgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLgogICAgICoKICAgICAqIEB0aHJvd3MgTnVsbFBvaW50ZXJFeGNlcHRpb24gaWYgdGhlIHNwZWNpZmllZCBlbGVtZW50IGlzIG51bGwKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gb2ZmZXIoRSBlKSB7CiAgICAgICAgY2hlY2tOb3ROdWxsKGUpOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGVucXVldWUoZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSwgd2FpdGluZwogICAgICogZm9yIHNwYWNlIHRvIGJlY29tZSBhdmFpbGFibGUgaWYgdGhlIHF1ZXVlIGlzIGZ1bGwuCiAgICAgKgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uIHtAaW5oZXJpdERvY30KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0KEUgZSkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBjaGVja05vdE51bGwoZSk7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9ja0ludGVycnVwdGlibHkoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAoY291bnQgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgbm90RnVsbC5hd2FpdCgpOwogICAgICAgICAgICBlbnF1ZXVlKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYXQgdGhlIHRhaWwgb2YgdGhpcyBxdWV1ZSwgd2FpdGluZwogICAgICogdXAgdG8gdGhlIHNwZWNpZmllZCB3YWl0IHRpbWUgZm9yIHNwYWNlIHRvIGJlY29tZSBhdmFpbGFibGUgaWYKICAgICAqIHRoZSBxdWV1ZSBpcyBmdWxsLgogICAgICoKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24ge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBOdWxsUG9pbnRlckV4Y2VwdGlvbiB7QGluaGVyaXREb2N9CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIG9mZmVyKEUgZSwgbG9uZyB0aW1lb3V0LCBUaW1lVW5pdCB1bml0KQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewoKICAgICAgICBjaGVja05vdE51bGwoZSk7CiAgICAgICAgbG9uZyBuYW5vcyA9IHVuaXQudG9OYW5vcyh0aW1lb3V0KTsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrSW50ZXJydXB0aWJseSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA9PSBpdGVtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChuYW5vcyA8PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIG5hbm9zID0gbm90RnVsbC5hd2FpdE5hbm9zKG5hbm9zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnF1ZXVlKGUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSBwb2xsKCkgewogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKGNvdW50ID09IDApID8gbnVsbCA6IGRlcXVldWUoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSB0YWtlKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrSW50ZXJydXB0aWJseSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA9PSAwKQogICAgICAgICAgICAgICAgbm90RW1wdHkuYXdhaXQoKTsKICAgICAgICAgICAgcmV0dXJuIGRlcXVldWUoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRSBwb2xsKGxvbmcgdGltZW91dCwgVGltZVVuaXQgdW5pdCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBsb25nIG5hbm9zID0gdW5pdC50b05hbm9zKHRpbWVvdXQpOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2tJbnRlcnJ1cHRpYmx5KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChuYW5vcyA8PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgbmFub3MgPSBub3RFbXB0eS5hd2FpdE5hbm9zKG5hbm9zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGVxdWV1ZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBFIHBlZWsoKSB7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtQXQodGFrZUluZGV4KTsgLy8gbnVsbCB3aGVuIHF1ZXVlIGlzIGVtcHR5CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gdGhpcyBkb2MgY29tbWVudCBpcyBvdmVycmlkZGVuIHRvIHJlbW92ZSB0aGUgcmVmZXJlbmNlIHRvIGNvbGxlY3Rpb25zCiAgICAvLyBncmVhdGVyIGluIHNpemUgdGhhbiBJbnRlZ2VyLk1BWF9WQUxVRQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZQogICAgICovCiAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGRvYyBjb21tZW50IGlzIGEgbW9kaWZpZWQgY29weSBvZiB0aGUgaW5oZXJpdGVkIGRvYyBjb21tZW50LAogICAgLy8gd2l0aG91dCB0aGUgcmVmZXJlbmNlIHRvIHVubGltaXRlZCBxdWV1ZXMuCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBhZGRpdGlvbmFsIGVsZW1lbnRzIHRoYXQgdGhpcyBxdWV1ZSBjYW4gaWRlYWxseQogICAgICogKGluIHRoZSBhYnNlbmNlIG9mIG1lbW9yeSBvciByZXNvdXJjZSBjb25zdHJhaW50cykgYWNjZXB0IHdpdGhvdXQKICAgICAqIGJsb2NraW5nLiBUaGlzIGlzIGFsd2F5cyBlcXVhbCB0byB0aGUgaW5pdGlhbCBjYXBhY2l0eSBvZiB0aGlzIHF1ZXVlCiAgICAgKiBsZXNzIHRoZSBjdXJyZW50IHtAY29kZSBzaXplfSBvZiB0aGlzIHF1ZXVlLgogICAgICoKICAgICAqIDxwPk5vdGUgdGhhdCB5b3UgPGVtPmNhbm5vdDwvZW0+IGFsd2F5cyB0ZWxsIGlmIGFuIGF0dGVtcHQgdG8gaW5zZXJ0CiAgICAgKiBhbiBlbGVtZW50IHdpbGwgc3VjY2VlZCBieSBpbnNwZWN0aW5nIHtAY29kZSByZW1haW5pbmdDYXBhY2l0eX0KICAgICAqIGJlY2F1c2UgaXQgbWF5IGJlIHRoZSBjYXNlIHRoYXQgYW5vdGhlciB0aHJlYWQgaXMgYWJvdXQgdG8KICAgICAqIGluc2VydCBvciByZW1vdmUgYW4gZWxlbWVudC4KICAgICAqLwogICAgcHVibGljIGludCByZW1haW5pbmdDYXBhY2l0eSgpIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW1zLmxlbmd0aCAtIGNvdW50OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvY2sudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhIHNpbmdsZSBpbnN0YW5jZSBvZiB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgZnJvbSB0aGlzIHF1ZXVlLAogICAgICogaWYgaXQgaXMgcHJlc2VudC4gIE1vcmUgZm9ybWFsbHksIHJlbW92ZXMgYW4gZWxlbWVudCB7QGNvZGUgZX0gc3VjaAogICAgICogdGhhdCB7QGNvZGUgby5lcXVhbHMoZSl9LCBpZiB0aGlzIHF1ZXVlIGNvbnRhaW5zIG9uZSBvciBtb3JlIHN1Y2gKICAgICAqIGVsZW1lbnRzLgogICAgICogUmV0dXJucyB7QGNvZGUgdHJ1ZX0gaWYgdGhpcyBxdWV1ZSBjb250YWluZWQgdGhlIHNwZWNpZmllZCBlbGVtZW50CiAgICAgKiAob3IgZXF1aXZhbGVudGx5LCBpZiB0aGlzIHF1ZXVlIGNoYW5nZWQgYXMgYSByZXN1bHQgb2YgdGhlIGNhbGwpLgogICAgICoKICAgICAqIDxwPlJlbW92YWwgb2YgaW50ZXJpb3IgZWxlbWVudHMgaW4gY2lyY3VsYXIgYXJyYXkgYmFzZWQgcXVldWVzCiAgICAgKiBpcyBhbiBpbnRyaW5zaWNhbGx5IHNsb3cgYW5kIGRpc3J1cHRpdmUgb3BlcmF0aW9uLCBzbyBzaG91bGQKICAgICAqIGJlIHVuZGVydGFrZW4gb25seSBpbiBleGNlcHRpb25hbCBjaXJjdW1zdGFuY2VzLCBpZGVhbGx5CiAgICAgKiBvbmx5IHdoZW4gdGhlIHF1ZXVlIGlzIGtub3duIG5vdCB0byBiZSBhY2Nlc3NpYmxlIGJ5IG90aGVyCiAgICAgKiB0aHJlYWRzLgogICAgICoKICAgICAqIEBwYXJhbSBvIGVsZW1lbnQgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoaXMgcXVldWUsIGlmIHByZXNlbnQKICAgICAqIEByZXR1cm4ge0Bjb2RlIHRydWV9IGlmIHRoaXMgcXVldWUgY2hhbmdlZCBhcyBhIHJlc3VsdCBvZiB0aGUgY2FsbAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG8pIHsKICAgICAgICBpZiAobyA9PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgZmluYWwgT2JqZWN0W10gaXRlbXMgPSB0aGlzLml0ZW1zOwogICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IHRoaXMubG9jazsKICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgcHV0SW5kZXggPSB0aGlzLnB1dEluZGV4OwogICAgICAgICAgICAgICAgaW50IGkgPSB0YWtlSW5kZXg7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG8uZXF1YWxzKGl0ZW1zW2ldKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgrK2kgPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGkgIT0gcHV0SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMge0Bjb2RlIHRydWV9IGlmIHRoaXMgcXVldWUgY29udGFpbnMgdGhlIHNwZWNpZmllZCBlbGVtZW50LgogICAgICogTW9yZSBmb3JtYWxseSwgcmV0dXJucyB7QGNvZGUgdHJ1ZX0gaWYgYW5kIG9ubHkgaWYgdGhpcyBxdWV1ZSBjb250YWlucwogICAgICogYXQgbGVhc3Qgb25lIGVsZW1lbnQge0Bjb2RlIGV9IHN1Y2ggdGhhdCB7QGNvZGUgby5lcXVhbHMoZSl9LgogICAgICoKICAgICAqIEBwYXJhbSBvIG9iamVjdCB0byBiZSBjaGVja2VkIGZvciBjb250YWlubWVudCBpbiB0aGlzIHF1ZXVlCiAgICAgKiBAcmV0dXJuIHtAY29kZSB0cnVlfSBpZiB0aGlzIHF1ZXVlIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgZWxlbWVudAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3QgbykgewogICAgICAgIGlmIChvID09IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBwdXRJbmRleCA9IHRoaXMucHV0SW5kZXg7CiAgICAgICAgICAgICAgICBpbnQgaSA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBpZiAoby5lcXVhbHMoaXRlbXNbaV0pKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoKytpID09IGl0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChpICE9IHB1dEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlLCBpbgogICAgICogcHJvcGVyIHNlcXVlbmNlLgogICAgICoKICAgICAqIDxwPlRoZSByZXR1cm5lZCBhcnJheSB3aWxsIGJlICJzYWZlIiBpbiB0aGF0IG5vIHJlZmVyZW5jZXMgdG8gaXQgYXJlCiAgICAgKiBtYWludGFpbmVkIGJ5IHRoaXMgcXVldWUuICAoSW4gb3RoZXIgd29yZHMsIHRoaXMgbWV0aG9kIG11c3QgYWxsb2NhdGUKICAgICAqIGEgbmV3IGFycmF5KS4gIFRoZSBjYWxsZXIgaXMgdGh1cyBmcmVlIHRvIG1vZGlmeSB0aGUgcmV0dXJuZWQgYXJyYXkuCiAgICAgKgogICAgICogPHA+VGhpcyBtZXRob2QgYWN0cyBhcyBicmlkZ2UgYmV0d2VlbiBhcnJheS1iYXNlZCBhbmQgY29sbGVjdGlvbi1iYXNlZAogICAgICogQVBJcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIG9mIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KCkgewogICAgICAgIE9iamVjdFtdIGE7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpbmFsIGludCBjb3VudCA9IHRoaXMuY291bnQ7CiAgICAgICAgICAgIGEgPSBuZXcgT2JqZWN0W2NvdW50XTsKICAgICAgICAgICAgaW50IG4gPSBpdGVtcy5sZW5ndGggLSB0YWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChjb3VudCA8PSBuKQogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgdGFrZUluZGV4LCBhLCAwLCBjb3VudCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgdGFrZUluZGV4LCBhLCAwLCBuKTsKICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoaXRlbXMsIDAsIGEsIG4sIGNvdW50IC0gbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyBhbGwgb2YgdGhlIGVsZW1lbnRzIGluIHRoaXMgcXVldWUsIGluCiAgICAgKiBwcm9wZXIgc2VxdWVuY2U7IHRoZSBydW50aW1lIHR5cGUgb2YgdGhlIHJldHVybmVkIGFycmF5IGlzIHRoYXQgb2YKICAgICAqIHRoZSBzcGVjaWZpZWQgYXJyYXkuICBJZiB0aGUgcXVldWUgZml0cyBpbiB0aGUgc3BlY2lmaWVkIGFycmF5LCBpdAogICAgICogaXMgcmV0dXJuZWQgdGhlcmVpbi4gIE90aGVyd2lzZSwgYSBuZXcgYXJyYXkgaXMgYWxsb2NhdGVkIHdpdGggdGhlCiAgICAgKiBydW50aW1lIHR5cGUgb2YgdGhlIHNwZWNpZmllZCBhcnJheSBhbmQgdGhlIHNpemUgb2YgdGhpcyBxdWV1ZS4KICAgICAqCiAgICAgKiA8cD5JZiB0aGlzIHF1ZXVlIGZpdHMgaW4gdGhlIHNwZWNpZmllZCBhcnJheSB3aXRoIHJvb20gdG8gc3BhcmUKICAgICAqIChpLmUuLCB0aGUgYXJyYXkgaGFzIG1vcmUgZWxlbWVudHMgdGhhbiB0aGlzIHF1ZXVlKSwgdGhlIGVsZW1lbnQgaW4KICAgICAqIHRoZSBhcnJheSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlIGVuZCBvZiB0aGUgcXVldWUgaXMgc2V0IHRvCiAgICAgKiB7QGNvZGUgbnVsbH0uCiAgICAgKgogICAgICogPHA+TGlrZSB0aGUge0BsaW5rICN0b0FycmF5KCl9IG1ldGhvZCwgdGhpcyBtZXRob2QgYWN0cyBhcyBicmlkZ2UgYmV0d2VlbgogICAgICogYXJyYXktYmFzZWQgYW5kIGNvbGxlY3Rpb24tYmFzZWQgQVBJcy4gIEZ1cnRoZXIsIHRoaXMgbWV0aG9kIGFsbG93cwogICAgICogcHJlY2lzZSBjb250cm9sIG92ZXIgdGhlIHJ1bnRpbWUgdHlwZSBvZiB0aGUgb3V0cHV0IGFycmF5LCBhbmQgbWF5LAogICAgICogdW5kZXIgY2VydGFpbiBjaXJjdW1zdGFuY2VzLCBiZSB1c2VkIHRvIHNhdmUgYWxsb2NhdGlvbiBjb3N0cy4KICAgICAqCiAgICAgKiA8cD5TdXBwb3NlIHtAY29kZSB4fSBpcyBhIHF1ZXVlIGtub3duIHRvIGNvbnRhaW4gb25seSBzdHJpbmdzLgogICAgICogVGhlIGZvbGxvd2luZyBjb2RlIGNhbiBiZSB1c2VkIHRvIGR1bXAgdGhlIHF1ZXVlIGludG8gYSBuZXdseQogICAgICogYWxsb2NhdGVkIGFycmF5IG9mIHtAY29kZSBTdHJpbmd9OgogICAgICoKICAgICAqICA8cHJlPiB7QGNvZGUgU3RyaW5nW10geSA9IHgudG9BcnJheShuZXcgU3RyaW5nWzBdKTt9PC9wcmU+CiAgICAgKgogICAgICogTm90ZSB0aGF0IHtAY29kZSB0b0FycmF5KG5ldyBPYmplY3RbMF0pfSBpcyBpZGVudGljYWwgaW4gZnVuY3Rpb24gdG8KICAgICAqIHtAY29kZSB0b0FycmF5KCl9LgogICAgICoKICAgICAqIEBwYXJhbSBhIHRoZSBhcnJheSBpbnRvIHdoaWNoIHRoZSBlbGVtZW50cyBvZiB0aGUgcXVldWUgYXJlIHRvCiAgICAgKiAgICAgICAgICBiZSBzdG9yZWQsIGlmIGl0IGlzIGJpZyBlbm91Z2g7IG90aGVyd2lzZSwgYSBuZXcgYXJyYXkgb2YgdGhlCiAgICAgKiAgICAgICAgICBzYW1lIHJ1bnRpbWUgdHlwZSBpcyBhbGxvY2F0ZWQgZm9yIHRoaXMgcHVycG9zZQogICAgICogQHJldHVybiBhbiBhcnJheSBjb250YWluaW5nIGFsbCBvZiB0aGUgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZQogICAgICogQHRocm93cyBBcnJheVN0b3JlRXhjZXB0aW9uIGlmIHRoZSBydW50aW1lIHR5cGUgb2YgdGhlIHNwZWNpZmllZCBhcnJheQogICAgICogICAgICAgICBpcyBub3QgYSBzdXBlcnR5cGUgb2YgdGhlIHJ1bnRpbWUgdHlwZSBvZiBldmVyeSBlbGVtZW50IGluCiAgICAgKiAgICAgICAgIHRoaXMgcXVldWUKICAgICAqIEB0aHJvd3MgTnVsbFBvaW50ZXJFeGNlcHRpb24gaWYgdGhlIHNwZWNpZmllZCBhcnJheSBpcyBudWxsCiAgICAgKi8KICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgcHVibGljIDxUPiBUW10gdG9BcnJheShUW10gYSkgewogICAgICAgIGZpbmFsIE9iamVjdFtdIGl0ZW1zID0gdGhpcy5pdGVtczsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluYWwgaW50IGNvdW50ID0gdGhpcy5jb3VudDsKICAgICAgICAgICAgZmluYWwgaW50IGxlbiA9IGEubGVuZ3RoOwogICAgICAgICAgICBpZiAobGVuIDwgY291bnQpCiAgICAgICAgICAgICAgICBhID0gKFRbXSlqYXZhLmxhbmcucmVmbGVjdC5BcnJheS5uZXdJbnN0YW5jZSgKICAgICAgICAgICAgICAgICAgICAgICAgYS5nZXRDbGFzcygpLmdldENvbXBvbmVudFR5cGUoKSwgY291bnQpOwogICAgICAgICAgICBpbnQgbiA9IGl0ZW1zLmxlbmd0aCAtIHRha2VJbmRleDsKICAgICAgICAgICAgaWYgKGNvdW50IDw9IG4pCiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGl0ZW1zLCB0YWtlSW5kZXgsIGEsIDAsIGNvdW50KTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGl0ZW1zLCB0YWtlSW5kZXgsIGEsIDAsIG4pOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShpdGVtcywgMCwgYSwgbiwgY291bnQgLSBuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGVuID4gY291bnQpCiAgICAgICAgICAgICAgICBhW2NvdW50XSA9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSB0aGlzLmxvY2s7CiAgICAgICAgbG9jay5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGsgPSBjb3VudDsKICAgICAgICAgICAgaWYgKGsgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiAiW10iOwoKICAgICAgICAgICAgZmluYWwgT2JqZWN0W10gaXRlbXMgPSB0aGlzLml0ZW1zOwogICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCdbJyk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSB0YWtlSW5kZXg7IDsgKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZSA9IGl0ZW1zW2ldOwogICAgICAgICAgICAgICAgc2IuYXBwZW5kKGUgPT0gdGhpcyA/ICIodGhpcyBDb2xsZWN0aW9uKSIgOiBlKTsKICAgICAgICAgICAgICAgIGlmICgtLWsgPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2IuYXBwZW5kKCddJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgnLCcpLmFwcGVuZCgnICcpOwogICAgICAgICAgICAgICAgaWYgKCsraSA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEF0b21pY2FsbHkgcmVtb3ZlcyBhbGwgb2YgdGhlIGVsZW1lbnRzIGZyb20gdGhpcyBxdWV1ZS4KICAgICAqIFRoZSBxdWV1ZSB3aWxsIGJlIGVtcHR5IGFmdGVyIHRoaXMgY2FsbCByZXR1cm5zLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBrID0gY291bnQ7CiAgICAgICAgICAgIGlmIChrID4gMCkgewogICAgICAgICAgICAgICAgZmluYWwgaW50IHB1dEluZGV4ID0gdGhpcy5wdXRJbmRleDsKICAgICAgICAgICAgICAgIGludCBpID0gdGFrZUluZGV4OwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoKytpID09IGl0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChpICE9IHB1dEluZGV4KTsKICAgICAgICAgICAgICAgIHRha2VJbmRleCA9IHB1dEluZGV4OwogICAgICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICAgICAgaWYgKGl0cnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpdHJzLnF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICAgICAgZm9yICg7IGsgPiAwICYmIGxvY2suaGFzV2FpdGVycyhub3RGdWxsKTsgay0tKQogICAgICAgICAgICAgICAgICAgIG5vdEZ1bGwuc2lnbmFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEB0aHJvd3MgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24ge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBDbGFzc0Nhc3RFeGNlcHRpb24gICAgICAgICAgICB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIE51bGxQb2ludGVyRXhjZXB0aW9uICAgICAgICAgIHtAaW5oZXJpdERvY30KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICAgICAge0Bpbmhlcml0RG9jfQogICAgICovCiAgICBwdWJsaWMgaW50IGRyYWluVG8oQ29sbGVjdGlvbjw/IHN1cGVyIEU+IGMpIHsKICAgICAgICByZXR1cm4gZHJhaW5UbyhjLCBJbnRlZ2VyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAdGhyb3dzIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uIHtAaW5oZXJpdERvY30KICAgICAqIEB0aHJvd3MgQ2xhc3NDYXN0RXhjZXB0aW9uICAgICAgICAgICAge0Bpbmhlcml0RG9jfQogICAgICogQHRocm93cyBOdWxsUG9pbnRlckV4Y2VwdGlvbiAgICAgICAgICB7QGluaGVyaXREb2N9CiAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAgICAgIHtAaW5oZXJpdERvY30KICAgICAqLwogICAgcHVibGljIGludCBkcmFpblRvKENvbGxlY3Rpb248PyBzdXBlciBFPiBjLCBpbnQgbWF4RWxlbWVudHMpIHsKICAgICAgICBjaGVja05vdE51bGwoYyk7CiAgICAgICAgaWYgKGMgPT0gdGhpcykKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgIGlmIChtYXhFbGVtZW50cyA8PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBmaW5hbCBPYmplY3RbXSBpdGVtcyA9IHRoaXMuaXRlbXM7CiAgICAgICAgZmluYWwgUmVlbnRyYW50TG9jayBsb2NrID0gdGhpcy5sb2NrOwogICAgICAgIGxvY2subG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBuID0gTWF0aC5taW4obWF4RWxlbWVudHMsIGNvdW50KTsKICAgICAgICAgICAgaW50IHRha2UgPSB0YWtlSW5kZXg7CiAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgbikgewogICAgICAgICAgICAgICAgICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgICAgICAgICAgICAgICAgIEUgeCA9IChFKSBpdGVtc1t0YWtlXTsKICAgICAgICAgICAgICAgICAgICBjLmFkZCh4KTsKICAgICAgICAgICAgICAgICAgICBpdGVtc1t0YWtlXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKCsrdGFrZSA9PSBpdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRha2UgPSAwOwogICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBpbnZhcmlhbnRzIGV2ZW4gaWYgYy5hZGQoKSB0aHJldwogICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY291bnQgLT0gaTsKICAgICAgICAgICAgICAgICAgICB0YWtlSW5kZXggPSB0YWtlOwogICAgICAgICAgICAgICAgICAgIGlmIChpdHJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdHJzLnF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gdGFrZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMudGFrZUluZGV4V3JhcHBlZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKDsgaSA+IDAgJiYgbG9jay5oYXNXYWl0ZXJzKG5vdEZ1bGwpOyBpLS0pCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdEZ1bGwuc2lnbmFsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gaXRlcmF0b3Igb3ZlciB0aGUgZWxlbWVudHMgaW4gdGhpcyBxdWV1ZSBpbiBwcm9wZXIgc2VxdWVuY2UuCiAgICAgKiBUaGUgZWxlbWVudHMgd2lsbCBiZSByZXR1cm5lZCBpbiBvcmRlciBmcm9tIGZpcnN0IChoZWFkKSB0byBsYXN0ICh0YWlsKS4KICAgICAqCiAgICAgKiA8cD5UaGUgcmV0dXJuZWQgaXRlcmF0b3IgaXMKICAgICAqIDxhIGhyZWY9InBhY2thZ2Utc3VtbWFyeS5odG1sI1dlYWtseSI+PGk+d2Vha2x5IGNvbnNpc3RlbnQ8L2k+PC9hPi4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIGVsZW1lbnRzIGluIHRoaXMgcXVldWUgaW4gcHJvcGVyIHNlcXVlbmNlCiAgICAgKi8KICAgIHB1YmxpYyBJdGVyYXRvcjxFPiBpdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gbmV3IGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNoYXJlZCBkYXRhIGJldHdlZW4gaXRlcmF0b3JzIGFuZCB0aGVpciBxdWV1ZSwgYWxsb3dpbmcgcXVldWUKICAgICAqIG1vZGlmaWNhdGlvbnMgdG8gdXBkYXRlIGl0ZXJhdG9ycyB3aGVuIGVsZW1lbnRzIGFyZSByZW1vdmVkLgogICAgICoKICAgICAqIFRoaXMgYWRkcyBhIGxvdCBvZiBjb21wbGV4aXR5IGZvciB0aGUgc2FrZSBvZiBjb3JyZWN0bHkKICAgICAqIGhhbmRsaW5nIHNvbWUgdW5jb21tb24gb3BlcmF0aW9ucywgYnV0IHRoZSBjb21iaW5hdGlvbiBvZgogICAgICogY2lyY3VsYXItYXJyYXlzIGFuZCBzdXBwb3J0aW5nIGludGVyaW9yIHJlbW92ZXMgKGkuZS4sIHRob3NlCiAgICAgKiBub3QgYXQgaGVhZCkgd291bGQgY2F1c2UgaXRlcmF0b3JzIHRvIHNvbWV0aW1lcyBsb3NlIHRoZWlyCiAgICAgKiBwbGFjZXMgYW5kL29yIChyZSlyZXBvcnQgZWxlbWVudHMgdGhleSBzaG91bGRuJ3QuICBUbyBhdm9pZAogICAgICogdGhpcywgd2hlbiBhIHF1ZXVlIGhhcyBvbmUgb3IgbW9yZSBpdGVyYXRvcnMsIGl0IGtlZXBzIGl0ZXJhdG9yCiAgICAgKiBzdGF0ZSBjb25zaXN0ZW50IGJ5OgogICAgICoKICAgICAqICgxKSBrZWVwaW5nIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgImN5Y2xlcyIsIHRoYXQgaXMsIHRoZQogICAgICogICAgIG51bWJlciBvZiB0aW1lcyB0YWtlSW5kZXggaGFzIHdyYXBwZWQgYXJvdW5kIHRvIDAuCiAgICAgKiAoMikgbm90aWZ5aW5nIGFsbCBpdGVyYXRvcnMgdmlhIHRoZSBjYWxsYmFjayByZW1vdmVkQXQgd2hlbmV2ZXIKICAgICAqICAgICBhbiBpbnRlcmlvciBlbGVtZW50IGlzIHJlbW92ZWQgKGFuZCB0aHVzIG90aGVyIGVsZW1lbnRzIG1heQogICAgICogICAgIGJlIHNoaWZ0ZWQpLgogICAgICoKICAgICAqIFRoZXNlIHN1ZmZpY2UgdG8gZWxpbWluYXRlIGl0ZXJhdG9yIGluY29uc2lzdGVuY2llcywgYnV0CiAgICAgKiB1bmZvcnR1bmF0ZWx5IGFkZCB0aGUgc2Vjb25kYXJ5IHJlc3BvbnNpYmlsaXR5IG9mIG1haW50YWluaW5nCiAgICAgKiB0aGUgbGlzdCBvZiBpdGVyYXRvcnMuICBXZSB0cmFjayBhbGwgYWN0aXZlIGl0ZXJhdG9ycyBpbiBhCiAgICAgKiBzaW1wbGUgbGlua2VkIGxpc3QgKGFjY2Vzc2VkIG9ubHkgd2hlbiB0aGUgcXVldWUncyBsb2NrIGlzCiAgICAgKiBoZWxkKSBvZiB3ZWFrIHJlZmVyZW5jZXMgdG8gSXRyLiAgVGhlIGxpc3QgaXMgY2xlYW5lZCB1cCB1c2luZwogICAgICogMyBkaWZmZXJlbnQgbWVjaGFuaXNtczoKICAgICAqCiAgICAgKiAoMSkgV2hlbmV2ZXIgYSBuZXcgaXRlcmF0b3IgaXMgY3JlYXRlZCwgZG8gc29tZSBPKDEpIGNoZWNraW5nIGZvcgogICAgICogICAgIHN0YWxlIGxpc3QgZWxlbWVudHMuCiAgICAgKgogICAgICogKDIpIFdoZW5ldmVyIHRha2VJbmRleCB3cmFwcyBhcm91bmQgdG8gMCwgY2hlY2sgZm9yIGl0ZXJhdG9ycwogICAgICogICAgIHRoYXQgaGF2ZSBiZWVuIHVudXNlZCBmb3IgbW9yZSB0aGFuIG9uZSB3cmFwLWFyb3VuZCBjeWNsZS4KICAgICAqCiAgICAgKiAoMykgV2hlbmV2ZXIgdGhlIHF1ZXVlIGJlY29tZXMgZW1wdHksIGFsbCBpdGVyYXRvcnMgYXJlIG5vdGlmaWVkCiAgICAgKiAgICAgYW5kIHRoaXMgZW50aXJlIGRhdGEgc3RydWN0dXJlIGlzIGRpc2NhcmRlZC4KICAgICAqCiAgICAgKiBTbyBpbiBhZGRpdGlvbiB0byB0aGUgcmVtb3ZlZEF0IGNhbGxiYWNrIHRoYXQgaXMgbmVjZXNzYXJ5IGZvcgogICAgICogY29ycmVjdG5lc3MsIGl0ZXJhdG9ycyBoYXZlIHRoZSBzaHV0ZG93biBhbmQgdGFrZUluZGV4V3JhcHBlZAogICAgICogY2FsbGJhY2tzIHRoYXQgaGVscCByZW1vdmUgc3RhbGUgaXRlcmF0b3JzIGZyb20gdGhlIGxpc3QuCiAgICAgKgogICAgICogV2hlbmV2ZXIgYSBsaXN0IGVsZW1lbnQgaXMgZXhhbWluZWQsIGl0IGlzIGV4cHVuZ2VkIGlmIGVpdGhlcgogICAgICogdGhlIEdDIGhhcyBkZXRlcm1pbmVkIHRoYXQgdGhlIGl0ZXJhdG9yIGlzIGRpc2NhcmRlZCwgb3IgaWYgdGhlCiAgICAgKiBpdGVyYXRvciByZXBvcnRzIHRoYXQgaXQgaXMgImRldGFjaGVkIiAoZG9lcyBub3QgbmVlZCBhbnkKICAgICAqIGZ1cnRoZXIgc3RhdGUgdXBkYXRlcykuICBPdmVyaGVhZCBpcyBtYXhpbWFsIHdoZW4gdGFrZUluZGV4CiAgICAgKiBuZXZlciBhZHZhbmNlcywgaXRlcmF0b3JzIGFyZSBkaXNjYXJkZWQgYmVmb3JlIHRoZXkgYXJlCiAgICAgKiBleGhhdXN0ZWQsIGFuZCBhbGwgcmVtb3ZhbHMgYXJlIGludGVyaW9yIHJlbW92ZXMsIGluIHdoaWNoIGNhc2UKICAgICAqIGFsbCBzdGFsZSBpdGVyYXRvcnMgYXJlIGRpc2NvdmVyZWQgYnkgdGhlIEdDLiAgQnV0IGV2ZW4gaW4gdGhpcwogICAgICogY2FzZSB3ZSBkb24ndCBpbmNyZWFzZSB0aGUgYW1vcnRpemVkIGNvbXBsZXhpdHkuCiAgICAgKgogICAgICogQ2FyZSBtdXN0IGJlIHRha2VuIHRvIGtlZXAgbGlzdCBzd2VlcGluZyBtZXRob2RzIGZyb20KICAgICAqIHJlZW50cmFudGx5IGludm9raW5nIGFub3RoZXIgc3VjaCBtZXRob2QsIGNhdXNpbmcgc3VidGxlCiAgICAgKiBjb3JydXB0aW9uIGJ1Z3MuCiAgICAgKi8KICAgIGNsYXNzIEl0cnMgewoKICAgICAgICAvKioKICAgICAgICAgKiBOb2RlIGluIGEgbGlua2VkIGxpc3Qgb2Ygd2VhayBpdGVyYXRvciByZWZlcmVuY2VzLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgY2xhc3MgTm9kZSBleHRlbmRzIFdlYWtSZWZlcmVuY2U8amF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0cj4gewogICAgICAgICAgICBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQ7CgogICAgICAgICAgICBOb2RlKGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHIgaXRlcmF0b3IsIGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgbmV4dCkgewogICAgICAgICAgICAgICAgc3VwZXIoaXRlcmF0b3IpOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqIEluY3JlbWVudGVkIHdoZW5ldmVyIHRha2VJbmRleCB3cmFwcyBhcm91bmQgdG8gMCAqLwogICAgICAgIGludCBjeWNsZXMgPSAwOwoKICAgICAgICAvKiogTGlua2VkIGxpc3Qgb2Ygd2VhayBpdGVyYXRvciByZWZlcmVuY2VzICovCiAgICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIGhlYWQ7CgogICAgICAgIC8qKiBVc2VkIHRvIGV4cHVuZ2Ugc3RhbGUgaXRlcmF0b3JzICovCiAgICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIHN3ZWVwZXIgPSBudWxsOwoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgU0hPUlRfU1dFRVBfUFJPQkVTID0gNDsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTE9OR19TV0VFUF9QUk9CRVMgPSAxNjsKCiAgICAgICAgSXRycyhqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRyIGluaXRpYWwpIHsKICAgICAgICAgICAgcmVnaXN0ZXIoaW5pdGlhbCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTd2VlcHMgaXRycywgbG9va2luZyBmb3IgYW5kIGV4cHVuZ2luZyBzdGFsZSBpdGVyYXRvcnMuCiAgICAgICAgICogSWYgYXQgbGVhc3Qgb25lIHdhcyBmb3VuZCwgdHJpZXMgaGFyZGVyIHRvIGZpbmQgbW9yZS4KICAgICAgICAgKiBDYWxsZWQgb25seSBmcm9tIGl0ZXJhdGluZyB0aHJlYWQuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gdHJ5SGFyZGVyIHdoZXRoZXIgdG8gc3RhcnQgaW4gdHJ5LWhhcmRlciBtb2RlLCBiZWNhdXNlCiAgICAgICAgICogdGhlcmUgaXMga25vd24gdG8gYmUgYXQgbGVhc3Qgb25lIGl0ZXJhdG9yIHRvIGNvbGxlY3QKICAgICAgICAgKi8KICAgICAgICB2b2lkIGRvU29tZVN3ZWVwaW5nKGJvb2xlYW4gdHJ5SGFyZGVyKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDE7CiAgICAgICAgICAgIC8vIGFzc2VydCBoZWFkICE9IG51bGw7CiAgICAgICAgICAgIGludCBwcm9iZXMgPSB0cnlIYXJkZXIgPyBMT05HX1NXRUVQX1BST0JFUyA6IFNIT1JUX1NXRUVQX1BST0JFUzsKICAgICAgICAgICAgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0cnMuTm9kZSBvLCBwOwogICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIHN3ZWVwZXIgPSB0aGlzLnN3ZWVwZXI7CiAgICAgICAgICAgIGJvb2xlYW4gcGFzc2VkR287ICAgLy8gdG8gbGltaXQgc2VhcmNoIHRvIG9uZSBmdWxsIHN3ZWVwCgogICAgICAgICAgICBpZiAoc3dlZXBlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgICAgIHAgPSBoZWFkOwogICAgICAgICAgICAgICAgcGFzc2VkR28gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbyA9IHN3ZWVwZXI7CiAgICAgICAgICAgICAgICBwID0gby5uZXh0OwogICAgICAgICAgICAgICAgcGFzc2VkR28gPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICg7IHByb2JlcyA+IDA7IHByb2Jlcy0tKSB7CiAgICAgICAgICAgICAgICBpZiAocCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhc3NlZEdvKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBvID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBwID0gaGVhZDsKICAgICAgICAgICAgICAgICAgICBwYXNzZWRHbyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRyIGl0ID0gcC5nZXQoKTsKICAgICAgICAgICAgICAgIGZpbmFsIGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgbmV4dCA9IHAubmV4dDsKICAgICAgICAgICAgICAgIGlmIChpdCA9PSBudWxsIHx8IGl0LmlzRGV0YWNoZWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGZvdW5kIGEgZGlzY2FyZGVkL2V4aGF1c3RlZCBpdGVyYXRvcgogICAgICAgICAgICAgICAgICAgIHByb2JlcyA9IExPTkdfU1dFRVBfUFJPQkVTOyAvLyAidHJ5IGhhcmRlciIKICAgICAgICAgICAgICAgICAgICAvLyB1bmxpbmsgcAogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBwLm5leHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZCA9IG5leHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlJ3ZlIHJ1biBvdXQgb2YgaXRlcmF0b3JzIHRvIHRyYWNrOyByZXRpcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgby5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbyA9IHA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwID0gbmV4dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zd2VlcGVyID0gKHAgPT0gbnVsbCkgPyBudWxsIDogbzsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEFkZHMgYSBuZXcgaXRlcmF0b3IgdG8gdGhlIGxpbmtlZCBsaXN0IG9mIHRyYWNrZWQgaXRlcmF0b3JzLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcmVnaXN0ZXIoamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdHIpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaGVhZCA9IG5ldyBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlKGl0ciwgaGVhZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgd2hlbmV2ZXIgdGFrZUluZGV4IHdyYXBzIGFyb3VuZCB0byAwLgogICAgICAgICAqCiAgICAgICAgICogTm90aWZpZXMgYWxsIGl0ZXJhdG9ycywgYW5kIGV4cHVuZ2VzIGFueSB0aGF0IGFyZSBub3cgc3RhbGUuCiAgICAgICAgICovCiAgICAgICAgdm9pZCB0YWtlSW5kZXhXcmFwcGVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBjeWNsZXMrKzsKICAgICAgICAgICAgZm9yIChqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG8gPSBudWxsLCBwID0gaGVhZDsgcCAhPSBudWxsOykgewogICAgICAgICAgICAgICAgZmluYWwgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQgPSBwLm5leHQ7CiAgICAgICAgICAgICAgICBpZiAoaXQgPT0gbnVsbCB8fCBpdC50YWtlSW5kZXhXcmFwcGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB1bmxpbmsgcAogICAgICAgICAgICAgICAgICAgIC8vIGFzc2VydCBpdCA9PSBudWxsIHx8IGl0LmlzRGV0YWNoZWQoKTsKICAgICAgICAgICAgICAgICAgICBwLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcC5uZXh0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAobyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkID0gbmV4dDsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG8ubmV4dCA9IG5leHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG8gPSBwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcCA9IG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlYWQgPT0gbnVsbCkgICAvLyBubyBtb3JlIGl0ZXJhdG9ycyB0byB0cmFjawogICAgICAgICAgICAgICAgaXRycyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgd2hlbmV2ZXIgYW4gaW50ZXJpb3IgcmVtb3ZlIChub3QgYXQgdGFrZUluZGV4KSBvY2N1cnJlZC4KICAgICAgICAgKgogICAgICAgICAqIE5vdGlmaWVzIGFsbCBpdGVyYXRvcnMsIGFuZCBleHB1bmdlcyBhbnkgdGhhdCBhcmUgbm93IHN0YWxlLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcmVtb3ZlZEF0KGludCByZW1vdmVkSW5kZXgpIHsKICAgICAgICAgICAgZm9yIChqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG8gPSBudWxsLCBwID0gaGVhZDsgcCAhPSBudWxsOykgewogICAgICAgICAgICAgICAgZmluYWwgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBmaW5hbCBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycy5Ob2RlIG5leHQgPSBwLm5leHQ7CiAgICAgICAgICAgICAgICBpZiAoaXQgPT0gbnVsbCB8fCBpdC5yZW1vdmVkQXQocmVtb3ZlZEluZGV4KSkgewogICAgICAgICAgICAgICAgICAgIC8vIHVubGluayBwCiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGl0ID09IG51bGwgfHwgaXQuaXNEZXRhY2hlZCgpOwogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBwLm5leHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQgPSBuZXh0OwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgby5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbyA9IHA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVhZCA9PSBudWxsKSAgIC8vIG5vIG1vcmUgaXRlcmF0b3JzIHRvIHRyYWNrCiAgICAgICAgICAgICAgICBpdHJzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciB0aGUgcXVldWUgYmVjb21lcyBlbXB0eS4KICAgICAgICAgKgogICAgICAgICAqIE5vdGlmaWVzIGFsbCBhY3RpdmUgaXRlcmF0b3JzIHRoYXQgdGhlIHF1ZXVlIGlzIGVtcHR5LAogICAgICAgICAqIGNsZWFycyBhbGwgd2VhayByZWZzLCBhbmQgdW5saW5rcyB0aGUgaXRycyBkYXRhc3RydWN0dXJlLgogICAgICAgICAqLwogICAgICAgIHZvaWQgcXVldWVJc0VtcHR5KCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBmb3IgKGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS5JdHJzLk5vZGUgcCA9IGhlYWQ7IHAgIT0gbnVsbDsgcCA9IHAubmV4dCkgewogICAgICAgICAgICAgICAgamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLkl0ciBpdCA9IHAuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoaXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHAuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBpdC5zaHV0ZG93bigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGhlYWQgPSBudWxsOwogICAgICAgICAgICBpdHJzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciBhbiBlbGVtZW50IGhhcyBiZWVuIGRlcXVldWVkIChhdCB0YWtlSW5kZXgpLgogICAgICAgICAqLwogICAgICAgIHZvaWQgZWxlbWVudERlcXVldWVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBpZiAoY291bnQgPT0gMCkKICAgICAgICAgICAgICAgIHF1ZXVlSXNFbXB0eSgpOwogICAgICAgICAgICBlbHNlIGlmICh0YWtlSW5kZXggPT0gMCkKICAgICAgICAgICAgICAgIHRha2VJbmRleFdyYXBwZWQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJdGVyYXRvciBmb3IgQXJyYXlCbG9ja2luZ1F1ZXVlLgogICAgICoKICAgICAqIFRvIG1haW50YWluIHdlYWsgY29uc2lzdGVuY3kgd2l0aCByZXNwZWN0IHRvIHB1dHMgYW5kIHRha2VzLCB3ZQogICAgICogcmVhZCBhaGVhZCBvbmUgc2xvdCwgc28gYXMgdG8gbm90IHJlcG9ydCBoYXNOZXh0IHRydWUgYnV0IHRoZW4KICAgICAqIG5vdCBoYXZlIGFuIGVsZW1lbnQgdG8gcmV0dXJuLgogICAgICoKICAgICAqIFdlIHN3aXRjaCBpbnRvICJkZXRhY2hlZCIgbW9kZSAoYWxsb3dpbmcgcHJvbXB0IHVubGlua2luZyBmcm9tCiAgICAgKiBpdHJzIHdpdGhvdXQgaGVscCBmcm9tIHRoZSBHQykgd2hlbiBhbGwgaW5kaWNlcyBhcmUgbmVnYXRpdmUsIG9yCiAgICAgKiB3aGVuIGhhc05leHQgcmV0dXJucyBmYWxzZSBmb3IgdGhlIGZpcnN0IHRpbWUuICBUaGlzIGFsbG93cyB0aGUKICAgICAqIGl0ZXJhdG9yIHRvIHRyYWNrIGNvbmN1cnJlbnQgdXBkYXRlcyBjb21wbGV0ZWx5IGFjY3VyYXRlbHksCiAgICAgKiBleGNlcHQgZm9yIHRoZSBjb3JuZXIgY2FzZSBvZiB0aGUgdXNlciBjYWxsaW5nIEl0ZXJhdG9yLnJlbW92ZSgpCiAgICAgKiBhZnRlciBoYXNOZXh0KCkgcmV0dXJuZWQgZmFsc2UuICBFdmVuIGluIHRoaXMgY2FzZSwgd2UgZW5zdXJlCiAgICAgKiB0aGF0IHdlIGRvbid0IHJlbW92ZSB0aGUgd3JvbmcgZWxlbWVudCBieSBrZWVwaW5nIHRyYWNrIG9mIHRoZQogICAgICogZXhwZWN0ZWQgZWxlbWVudCB0byByZW1vdmUsIGluIGxhc3RJdGVtLiAgWWVzLCB3ZSBtYXkgZmFpbCB0bwogICAgICogcmVtb3ZlIGxhc3RJdGVtIGZyb20gdGhlIHF1ZXVlIGlmIGl0IG1vdmVkIGR1ZSB0byBhbiBpbnRlcmxlYXZlZAogICAgICogaW50ZXJpb3IgcmVtb3ZlIHdoaWxlIGluIGRldGFjaGVkIG1vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgSXRyIGltcGxlbWVudHMgSXRlcmF0b3I8RT4gewogICAgICAgIC8qKiBJbmRleCB0byBsb29rIGZvciBuZXcgbmV4dEl0ZW07IE5PTkUgYXQgZW5kICovCiAgICAgICAgcHJpdmF0ZSBpbnQgY3Vyc29yOwoKICAgICAgICAvKiogRWxlbWVudCB0byBiZSByZXR1cm5lZCBieSBuZXh0IGNhbGwgdG8gbmV4dCgpOyBudWxsIGlmIG5vbmUgKi8KICAgICAgICBwcml2YXRlIEUgbmV4dEl0ZW07CgogICAgICAgIC8qKiBJbmRleCBvZiBuZXh0SXRlbTsgTk9ORSBpZiBub25lLCBSRU1PVkVEIGlmIHJlbW92ZWQgZWxzZXdoZXJlICovCiAgICAgICAgcHJpdmF0ZSBpbnQgbmV4dEluZGV4OwoKICAgICAgICAvKiogTGFzdCBlbGVtZW50IHJldHVybmVkOyBudWxsIGlmIG5vbmUgb3Igbm90IGRldGFjaGVkLiAqLwogICAgICAgIHByaXZhdGUgRSBsYXN0SXRlbTsKCiAgICAgICAgLyoqIEluZGV4IG9mIGxhc3RJdGVtLCBOT05FIGlmIG5vbmUsIFJFTU9WRUQgaWYgcmVtb3ZlZCBlbHNld2hlcmUgKi8KICAgICAgICBwcml2YXRlIGludCBsYXN0UmV0OwoKICAgICAgICAvKiogUHJldmlvdXMgdmFsdWUgb2YgdGFrZUluZGV4LCBvciBERVRBQ0hFRCB3aGVuIGRldGFjaGVkICovCiAgICAgICAgcHJpdmF0ZSBpbnQgcHJldlRha2VJbmRleDsKCiAgICAgICAgLyoqIFByZXZpb3VzIHZhbHVlIG9mIGl0ZXJzLmN5Y2xlcyAqLwogICAgICAgIHByaXZhdGUgaW50IHByZXZDeWNsZXM7CgogICAgICAgIC8qKiBTcGVjaWFsIGluZGV4IHZhbHVlIGluZGljYXRpbmcgIm5vdCBhdmFpbGFibGUiIG9yICJ1bmRlZmluZWQiICovCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE5PTkUgPSAtMTsKCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lhbCBpbmRleCB2YWx1ZSBpbmRpY2F0aW5nICJyZW1vdmVkIGVsc2V3aGVyZSIsIHRoYXQgaXMsCiAgICAgICAgICogcmVtb3ZlZCBieSBzb21lIG9wZXJhdGlvbiBvdGhlciB0aGFuIGEgY2FsbCB0byB0aGlzLnJlbW92ZSgpLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBSRU1PVkVEID0gLTI7CgogICAgICAgIC8qKiBTcGVjaWFsIHZhbHVlIGZvciBwcmV2VGFrZUluZGV4IGluZGljYXRpbmcgImRldGFjaGVkIG1vZGUiICovCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IERFVEFDSEVEID0gLTM7CgogICAgICAgIEl0cigpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMDsKICAgICAgICAgICAgbGFzdFJldCA9IE5PTkU7CiAgICAgICAgICAgIGZpbmFsIFJlZW50cmFudExvY2sgbG9jayA9IGphdmEudXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZS50aGlzLmxvY2s7CiAgICAgICAgICAgIGxvY2subG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgaXRycyA9PSBudWxsOwogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IE5PTkU7CiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gTk9ORTsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFrZUluZGV4ID0gREVUQUNIRUQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIGludCB0YWtlSW5kZXggPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy50YWtlSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgcHJldlRha2VJbmRleCA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbSA9IGl0ZW1BdChuZXh0SW5kZXggPSB0YWtlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IGluY0N1cnNvcih0YWtlSW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGlmIChpdHJzID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRycyA9IG5ldyBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUuSXRycyh0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpdHJzLnJlZ2lzdGVyKHRoaXMpOyAvLyBpbiB0aGlzIG9yZGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGl0cnMuZG9Tb21lU3dlZXBpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwcmV2Q3ljbGVzID0gaXRycy5jeWNsZXM7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IHRha2VJbmRleCA+PSAwOwogICAgICAgICAgICAgICAgICAgIC8vIGFzc2VydCBwcmV2VGFrZUluZGV4ID09IHRha2VJbmRleDsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgbmV4dEluZGV4ID49IDA7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IG5leHRJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGlzRGV0YWNoZWQoKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDE7CiAgICAgICAgICAgIHJldHVybiBwcmV2VGFrZUluZGV4IDwgMDsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IGluY0N1cnNvcihpbnQgaW5kZXgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaWYgKCsraW5kZXggPT0gaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICBpZiAoaW5kZXggPT0gcHV0SW5kZXgpCiAgICAgICAgICAgICAgICBpbmRleCA9IE5PTkU7CiAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiBpbmRleCBpcyBpbnZhbGlkYXRlZCBieSB0aGUgZ2l2ZW4gbnVtYmVyIG9mCiAgICAgICAgICogZGVxdWV1ZXMsIHN0YXJ0aW5nIGZyb20gcHJldlRha2VJbmRleC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIGJvb2xlYW4gaW52YWxpZGF0ZWQoaW50IGluZGV4LCBpbnQgcHJldlRha2VJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBkZXF1ZXVlcywgaW50IGxlbmd0aCkgewogICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpbnQgZGlzdGFuY2UgPSBpbmRleCAtIHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDApCiAgICAgICAgICAgICAgICBkaXN0YW5jZSArPSBsZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBkZXF1ZXVlcyA+IGRpc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRqdXN0cyBpbmRpY2VzIHRvIGluY29ycG9yYXRlIGFsbCBkZXF1ZXVlcyBzaW5jZSB0aGUgbGFzdAogICAgICAgICAqIG9wZXJhdGlvbiBvbiB0aGlzIGl0ZXJhdG9yLiAgQ2FsbCBvbmx5IGZyb20gaXRlcmF0aW5nIHRocmVhZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgaW5jb3Jwb3JhdGVEZXF1ZXVlcygpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgLy8gYXNzZXJ0IGl0cnMgIT0gbnVsbDsKICAgICAgICAgICAgLy8gYXNzZXJ0ICFpc0RldGFjaGVkKCk7CiAgICAgICAgICAgIC8vIGFzc2VydCBjb3VudCA+IDA7CgogICAgICAgICAgICBmaW5hbCBpbnQgY3ljbGVzID0gaXRycy5jeWNsZXM7CiAgICAgICAgICAgIGZpbmFsIGludCB0YWtlSW5kZXggPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy50YWtlSW5kZXg7CiAgICAgICAgICAgIGZpbmFsIGludCBwcmV2Q3ljbGVzID0gdGhpcy5wcmV2Q3ljbGVzOwogICAgICAgICAgICBmaW5hbCBpbnQgcHJldlRha2VJbmRleCA9IHRoaXMucHJldlRha2VJbmRleDsKCiAgICAgICAgICAgIGlmIChjeWNsZXMgIT0gcHJldkN5Y2xlcyB8fCB0YWtlSW5kZXggIT0gcHJldlRha2VJbmRleCkgewogICAgICAgICAgICAgICAgZmluYWwgaW50IGxlbiA9IGl0ZW1zLmxlbmd0aDsKICAgICAgICAgICAgICAgIC8vIGhvdyBmYXIgdGFrZUluZGV4IGhhcyBhZHZhbmNlZCBzaW5jZSB0aGUgcHJldmlvdXMKICAgICAgICAgICAgICAgIC8vIG9wZXJhdGlvbiBvZiB0aGlzIGl0ZXJhdG9yCiAgICAgICAgICAgICAgICBsb25nIGRlcXVldWVzID0gKGN5Y2xlcyAtIHByZXZDeWNsZXMpICogbGVuCiAgICAgICAgICAgICAgICAgICAgICAgICsgKHRha2VJbmRleCAtIHByZXZUYWtlSW5kZXgpOwoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGluZGljZXMgZm9yIGludmFsaWRhdGlvbgogICAgICAgICAgICAgICAgaWYgKGludmFsaWRhdGVkKGxhc3RSZXQsIHByZXZUYWtlSW5kZXgsIGRlcXVldWVzLCBsZW4pKQogICAgICAgICAgICAgICAgICAgIGxhc3RSZXQgPSBSRU1PVkVEOwogICAgICAgICAgICAgICAgaWYgKGludmFsaWRhdGVkKG5leHRJbmRleCwgcHJldlRha2VJbmRleCwgZGVxdWV1ZXMsIGxlbikpCiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gUkVNT1ZFRDsKICAgICAgICAgICAgICAgIGlmIChpbnZhbGlkYXRlZChjdXJzb3IsIHByZXZUYWtlSW5kZXgsIGRlcXVldWVzLCBsZW4pKQogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IHRha2VJbmRleDsKCiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yIDwgMCAmJiBuZXh0SW5kZXggPCAwICYmIGxhc3RSZXQgPCAwKQogICAgICAgICAgICAgICAgICAgIGRldGFjaCgpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2Q3ljbGVzID0gY3ljbGVzOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHJldlRha2VJbmRleCA9IHRha2VJbmRleDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbGVkIHdoZW4gaXRycyBzaG91bGQgc3RvcCB0cmFja2luZyB0aGlzIGl0ZXJhdG9yLCBlaXRoZXIKICAgICAgICAgKiBiZWNhdXNlIHRoZXJlIGFyZSBubyBtb3JlIGluZGljZXMgdG8gdXBkYXRlIChjdXJzb3IgPCAwICYmCiAgICAgICAgICogbmV4dEluZGV4IDwgMCAmJiBsYXN0UmV0IDwgMCkgb3IgYXMgYSBzcGVjaWFsIGV4Y2VwdGlvbiwgd2hlbgogICAgICAgICAqIGxhc3RSZXQgPj0gMCwgYmVjYXVzZSBoYXNOZXh0KCkgaXMgYWJvdXQgdG8gcmV0dXJuIGZhbHNlIGZvciB0aGUKICAgICAgICAgKiBmaXJzdCB0aW1lLiAgQ2FsbCBvbmx5IGZyb20gaXRlcmF0aW5nIHRocmVhZC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgZGV0YWNoKCkgewogICAgICAgICAgICAvLyBTd2l0Y2ggdG8gZGV0YWNoZWQgbW9kZQogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICAvLyBhc3NlcnQgY3Vyc29yID09IE5PTkU7CiAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggPCAwOwogICAgICAgICAgICAvLyBhc3NlcnQgbGFzdFJldCA8IDAgfHwgbmV4dEl0ZW0gPT0gbnVsbDsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPCAwIF4gbGFzdEl0ZW0gIT0gbnVsbDsKICAgICAgICAgICAgaWYgKHByZXZUYWtlSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGl0cnMgIT0gbnVsbDsKICAgICAgICAgICAgICAgIHByZXZUYWtlSW5kZXggPSBERVRBQ0hFRDsKICAgICAgICAgICAgICAgIC8vIHRyeSB0byB1bmxpbmsgZnJvbSBpdHJzIChidXQgbm90IHRvbyBoYXJkKQogICAgICAgICAgICAgICAgaXRycy5kb1NvbWVTd2VlcGluZyh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMsIHdlIHdvdWxkIGxpa2Ugbm90IHRvIGFjcXVpcmUgYSBsb2NrIGluCiAgICAgICAgICogaGFzTmV4dCBpbiB0aGUgY29tbW9uIGNhc2UuICBUbyBhbGxvdyBmb3IgdGhpcywgd2Ugb25seSBhY2Nlc3MKICAgICAgICAgKiBmaWVsZHMgKGkuZS4gbmV4dEl0ZW0pIHRoYXQgYXJlIG5vdCBtb2RpZmllZCBieSB1cGRhdGUgb3BlcmF0aW9ucwogICAgICAgICAqIHRyaWdnZXJlZCBieSBxdWV1ZSBtb2RpZmljYXRpb25zLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgIC8vIGFzc2VydCBsb2NrLmdldEhvbGRDb3VudCgpID09IDA7CiAgICAgICAgICAgIGlmIChuZXh0SXRlbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIG5vTmV4dCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgbm9OZXh0KCkgewogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBjdXJzb3IgPT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggPT0gTk9ORTsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPj0gMDsKICAgICAgICAgICAgICAgICAgICBpbmNvcnBvcmF0ZURlcXVldWVzKCk7IC8vIG1pZ2h0IHVwZGF0ZSBsYXN0UmV0CiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RSZXQgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0SXRlbSA9IGl0ZW1BdChsYXN0UmV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGFzc2VydCBpc0RldGFjaGVkKCk7CiAgICAgICAgICAgICAgICAvLyBhc3NlcnQgbGFzdFJldCA8IDAgXiBsYXN0SXRlbSAhPSBudWxsOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgbG9jay51bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIEUgbmV4dCgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMDsKICAgICAgICAgICAgZmluYWwgRSB4ID0gbmV4dEl0ZW07CiAgICAgICAgICAgIGlmICh4ID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9TdWNoRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIGluY29ycG9yYXRlRGVxdWV1ZXMoKTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBuZXh0SW5kZXggIT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBsYXN0SXRlbSA9PSBudWxsOwogICAgICAgICAgICAgICAgbGFzdFJldCA9IG5leHRJbmRleDsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBjdXJzb3IgPSB0aGlzLmN1cnNvcjsKICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIG5leHRJdGVtID0gaXRlbUF0KG5leHRJbmRleCA9IGN1cnNvcik7CiAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IG5leHRJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJzb3IgPSBpbmNDdXJzb3IoY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEluZGV4ID0gTk9ORTsKICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAwOwogICAgICAgICAgICBmaW5hbCBSZWVudHJhbnRMb2NrIGxvY2sgPSBqYXZhLnV0aWwuY29uY3VycmVudC5BcnJheUJsb2NraW5nUXVldWUudGhpcy5sb2NrOwogICAgICAgICAgICBsb2NrLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIGluY29ycG9yYXRlRGVxdWV1ZXMoKTsgLy8gbWlnaHQgdXBkYXRlIGxhc3RSZXQgb3IgZGV0YWNoCiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgbGFzdFJldCA9IHRoaXMubGFzdFJldDsKICAgICAgICAgICAgICAgIHRoaXMubGFzdFJldCA9IE5PTkU7CiAgICAgICAgICAgICAgICBpZiAobGFzdFJldCA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0KGxhc3RSZXQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBFIGxhc3RJdGVtID0gdGhpcy5sYXN0SXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RJdGVtICE9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdEl0ZW0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUF0KGxhc3RSZXQpID09IGxhc3RJdGVtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXQobGFzdFJldCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsYXN0UmV0ID09IE5PTkUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgLy8gZWxzZSBsYXN0UmV0ID09IFJFTU9WRUQgYW5kIHRoZSBsYXN0IHJldHVybmVkIGVsZW1lbnQgd2FzCiAgICAgICAgICAgICAgICAvLyBwcmV2aW91c2x5IGFzeW5jaHJvbm91c2x5IHJlbW92ZWQgdmlhIGFuIG9wZXJhdGlvbiBvdGhlcgogICAgICAgICAgICAgICAgLy8gdGhhbiB0aGlzLnJlbW92ZSgpLCBzbyBub3RoaW5nIHRvIGRvLgoKICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPCAwICYmIG5leHRJbmRleCA8IDApCiAgICAgICAgICAgICAgICAgICAgZGV0YWNoKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsb2NrLnVubG9jaygpOwogICAgICAgICAgICAgICAgLy8gYXNzZXJ0IGxhc3RSZXQgPT0gTk9ORTsKICAgICAgICAgICAgICAgIC8vIGFzc2VydCBsYXN0SXRlbSA9PSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgdG8gbm90aWZ5IHRoZSBpdGVyYXRvciB0aGF0IHRoZSBxdWV1ZSBpcyBlbXB0eSwgb3IgdGhhdCBpdAogICAgICAgICAqIGhhcyBmYWxsZW4gaG9wZWxlc3NseSBiZWhpbmQsIHNvIHRoYXQgaXQgc2hvdWxkIGFiYW5kb24gYW55CiAgICAgICAgICogZnVydGhlciBpdGVyYXRpb24sIGV4Y2VwdCBwb3NzaWJseSB0byByZXR1cm4gb25lIG1vcmUgZWxlbWVudAogICAgICAgICAqIGZyb20gbmV4dCgpLCBhcyBwcm9taXNlZCBieSByZXR1cm5pbmcgdHJ1ZSBmcm9tIGhhc05leHQoKS4KICAgICAgICAgKi8KICAgICAgICB2b2lkIHNodXRkb3duKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBjdXJzb3IgPSBOT05FOwogICAgICAgICAgICBpZiAobmV4dEluZGV4ID49IDApCiAgICAgICAgICAgICAgICBuZXh0SW5kZXggPSBSRU1PVkVEOwogICAgICAgICAgICBpZiAobGFzdFJldCA+PSAwKSB7CiAgICAgICAgICAgICAgICBsYXN0UmV0ID0gUkVNT1ZFRDsKICAgICAgICAgICAgICAgIGxhc3RJdGVtID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmV2VGFrZUluZGV4ID0gREVUQUNIRUQ7CiAgICAgICAgICAgIC8vIERvbid0IHNldCBuZXh0SXRlbSB0byBudWxsIGJlY2F1c2Ugd2UgbXVzdCBjb250aW51ZSB0byBiZQogICAgICAgICAgICAvLyBhYmxlIHRvIHJldHVybiBpdCBvbiBuZXh0KCkuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIENhbGxlciB3aWxsIHVubGluayBmcm9tIGl0cnMgd2hlbiBjb252ZW5pZW50LgogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgZGlzdGFuY2UoaW50IGluZGV4LCBpbnQgcHJldlRha2VJbmRleCwgaW50IGxlbmd0aCkgewogICAgICAgICAgICBpbnQgZGlzdGFuY2UgPSBpbmRleCAtIHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDApCiAgICAgICAgICAgICAgICBkaXN0YW5jZSArPSBsZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBkaXN0YW5jZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciBhbiBpbnRlcmlvciByZW1vdmUgKG5vdCBhdCB0YWtlSW5kZXgpIG9jY3VycmVkLgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiB0cnVlIGlmIHRoaXMgaXRlcmF0b3Igc2hvdWxkIGJlIHVubGlua2VkIGZyb20gaXRycwogICAgICAgICAqLwogICAgICAgIGJvb2xlYW4gcmVtb3ZlZEF0KGludCByZW1vdmVkSW5kZXgpIHsKICAgICAgICAgICAgLy8gYXNzZXJ0IGxvY2suZ2V0SG9sZENvdW50KCkgPT0gMTsKICAgICAgICAgICAgaWYgKGlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgZmluYWwgaW50IGN5Y2xlcyA9IGl0cnMuY3ljbGVzOwogICAgICAgICAgICBmaW5hbCBpbnQgdGFrZUluZGV4ID0gamF2YS51dGlsLmNvbmN1cnJlbnQuQXJyYXlCbG9ja2luZ1F1ZXVlLnRoaXMudGFrZUluZGV4OwogICAgICAgICAgICBmaW5hbCBpbnQgcHJldkN5Y2xlcyA9IHRoaXMucHJldkN5Y2xlczsKICAgICAgICAgICAgZmluYWwgaW50IHByZXZUYWtlSW5kZXggPSB0aGlzLnByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgIGZpbmFsIGludCBsZW4gPSBpdGVtcy5sZW5ndGg7CiAgICAgICAgICAgIGludCBjeWNsZURpZmYgPSBjeWNsZXMgLSBwcmV2Q3ljbGVzOwogICAgICAgICAgICBpZiAocmVtb3ZlZEluZGV4IDwgdGFrZUluZGV4KQogICAgICAgICAgICAgICAgY3ljbGVEaWZmKys7CiAgICAgICAgICAgIGZpbmFsIGludCByZW1vdmVkRGlzdGFuY2UgPQogICAgICAgICAgICAgICAgICAgIChjeWNsZURpZmYgKiBsZW4pICsgKHJlbW92ZWRJbmRleCAtIHByZXZUYWtlSW5kZXgpOwogICAgICAgICAgICAvLyBhc3NlcnQgcmVtb3ZlZERpc3RhbmNlID49IDA7CiAgICAgICAgICAgIGludCBjdXJzb3IgPSB0aGlzLmN1cnNvcjsKICAgICAgICAgICAgaWYgKGN1cnNvciA+PSAwKSB7CiAgICAgICAgICAgICAgICBpbnQgeCA9IGRpc3RhbmNlKGN1cnNvciwgcHJldlRha2VJbmRleCwgbGVuKTsKICAgICAgICAgICAgICAgIGlmICh4ID09IHJlbW92ZWREaXN0YW5jZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPT0gcHV0SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3Vyc29yID0gY3Vyc29yID0gTk9ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHggPiByZW1vdmVkRGlzdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBhc3NlcnQgY3Vyc29yICE9IHByZXZUYWtlSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJzb3IgPSBjdXJzb3IgPSBkZWMoY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpbnQgbGFzdFJldCA9IHRoaXMubGFzdFJldDsKICAgICAgICAgICAgaWYgKGxhc3RSZXQgPj0gMCkgewogICAgICAgICAgICAgICAgaW50IHggPSBkaXN0YW5jZShsYXN0UmV0LCBwcmV2VGFrZUluZGV4LCBsZW4pOwogICAgICAgICAgICAgICAgaWYgKHggPT0gcmVtb3ZlZERpc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFJldCA9IGxhc3RSZXQgPSBSRU1PVkVEOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoeCA+IHJlbW92ZWREaXN0YW5jZSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RSZXQgPSBsYXN0UmV0ID0gZGVjKGxhc3RSZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGludCBuZXh0SW5kZXggPSB0aGlzLm5leHRJbmRleDsKICAgICAgICAgICAgaWYgKG5leHRJbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgICBpbnQgeCA9IGRpc3RhbmNlKG5leHRJbmRleCwgcHJldlRha2VJbmRleCwgbGVuKTsKICAgICAgICAgICAgICAgIGlmICh4ID09IHJlbW92ZWREaXN0YW5jZSkKICAgICAgICAgICAgICAgICAgICB0aGlzLm5leHRJbmRleCA9IG5leHRJbmRleCA9IFJFTU9WRUQ7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh4ID4gcmVtb3ZlZERpc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dEluZGV4ID0gbmV4dEluZGV4ID0gZGVjKG5leHRJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY3Vyc29yIDwgMCAmJiBuZXh0SW5kZXggPCAwICYmIGxhc3RSZXQgPCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnByZXZUYWtlSW5kZXggPSBERVRBQ0hFRDsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuZXZlciB0YWtlSW5kZXggd3JhcHMgYXJvdW5kIHRvIHplcm8uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhpcyBpdGVyYXRvciBzaG91bGQgYmUgdW5saW5rZWQgZnJvbSBpdHJzCiAgICAgICAgICovCiAgICAgICAgYm9vbGVhbiB0YWtlSW5kZXhXcmFwcGVkKCkgewogICAgICAgICAgICAvLyBhc3NlcnQgbG9jay5nZXRIb2xkQ291bnQoKSA9PSAxOwogICAgICAgICAgICBpZiAoaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChpdHJzLmN5Y2xlcyAtIHByZXZDeWNsZXMgPiAxKSB7CiAgICAgICAgICAgICAgICAvLyBBbGwgdGhlIGVsZW1lbnRzIHRoYXQgZXhpc3RlZCBhdCB0aGUgdGltZSBvZiB0aGUgbGFzdAogICAgICAgICAgICAgICAgLy8gb3BlcmF0aW9uIGFyZSBnb25lLCBzbyBhYmFuZG9uIGZ1cnRoZXIgaXRlcmF0aW9uLgogICAgICAgICAgICAgICAgc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgovLyAgICAgICAgIC8qKiBVbmNvbW1lbnQgZm9yIGRlYnVnZ2luZy4gKi8KLy8gICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewovLyAgICAgICAgICAgICByZXR1cm4gKCJjdXJzb3I9IiArIGN1cnNvciArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgIm5leHRJbmRleD0iICsgbmV4dEluZGV4ICsgIiAiICsKLy8gICAgICAgICAgICAgICAgICAgICAibGFzdFJldD0iICsgbGFzdFJldCArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgIm5leHRJdGVtPSIgKyBuZXh0SXRlbSArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgImxhc3RJdGVtPSIgKyBsYXN0SXRlbSArICIgIiArCi8vICAgICAgICAgICAgICAgICAgICAgInByZXZDeWNsZXM9IiArIHByZXZDeWNsZXMgKyAiICIgKwovLyAgICAgICAgICAgICAgICAgICAgICJwcmV2VGFrZUluZGV4PSIgKyBwcmV2VGFrZUluZGV4ICsgIiAiICsKLy8gICAgICAgICAgICAgICAgICAgICAic2l6ZSgpPSIgKyBzaXplKCkgKyAiICIgKwovLyAgICAgICAgICAgICAgICAgICAgICJyZW1haW5pbmdDYXBhY2l0eSgpPSIgKyByZW1haW5pbmdDYXBhY2l0eSgpKTsKLy8gICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEge0BsaW5rIFNwbGl0ZXJhdG9yfSBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlLgogICAgICoKICAgICAqIDxwPlRoZSByZXR1cm5lZCBzcGxpdGVyYXRvciBpcwogICAgICogPGEgaHJlZj0icGFja2FnZS1zdW1tYXJ5Lmh0bWwjV2Vha2x5Ij48aT53ZWFrbHkgY29uc2lzdGVudDwvaT48L2E+LgogICAgICoKICAgICAqIDxwPlRoZSB7QGNvZGUgU3BsaXRlcmF0b3J9IHJlcG9ydHMge0BsaW5rIFNwbGl0ZXJhdG9yI0NPTkNVUlJFTlR9LAogICAgICoge0BsaW5rIFNwbGl0ZXJhdG9yI09SREVSRUR9LCBhbmQge0BsaW5rIFNwbGl0ZXJhdG9yI05PTk5VTEx9LgogICAgICoKICAgICAqIEBpbXBsTm90ZQogICAgICogVGhlIHtAY29kZSBTcGxpdGVyYXRvcn0gaW1wbGVtZW50cyB7QGNvZGUgdHJ5U3BsaXR9IHRvIHBlcm1pdCBsaW1pdGVkCiAgICAgKiBwYXJhbGxlbGlzbS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGEge0Bjb2RlIFNwbGl0ZXJhdG9yfSBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGlzIHF1ZXVlCiAgICAgKiBAc2luY2UgMS44CiAgICAgKi8KICAgIHB1YmxpYyBTcGxpdGVyYXRvcjxFPiBzcGxpdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gU3BsaXRlcmF0b3JzLnNwbGl0ZXJhdG9yCiAgICAgICAgICAgICAgICAodGhpcywgU3BsaXRlcmF0b3IuT1JERVJFRCB8IFNwbGl0ZXJhdG9yLk5PTk5VTEwgfAogICAgICAgICAgICAgICAgICAgICAgICBTcGxpdGVyYXRvci5DT05DVVJSRU5UKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlc2VyaWFsaXplcyB0aGlzIHF1ZXVlIGFuZCB0aGVuIGNoZWNrcyBzb21lIGludmFyaWFudHMuCiAgICAgKgogICAgICogQHBhcmFtIHMgdGhlIGlucHV0IHN0cmVhbQogICAgICogQHRocm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGlmIHRoZSBjbGFzcyBvZiBhIHNlcmlhbGl6ZWQgb2JqZWN0CiAgICAgKiAgICAgICAgIGNvdWxkIG5vdCBiZSBmb3VuZAogICAgICogQHRocm93cyBqYXZhLmlvLkludmFsaWRPYmplY3RFeGNlcHRpb24gaWYgaW52YXJpYW50cyBhcmUgdmlvbGF0ZWQKICAgICAqIEB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiBpZiBhbiBJL08gZXJyb3Igb2NjdXJzCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFkT2JqZWN0KGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW0gcykKICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewoKICAgICAgICAvLyBSZWFkIGluIGl0ZW1zIGFycmF5IGFuZCB2YXJpb3VzIGZpZWxkcwogICAgICAgIHMuZGVmYXVsdFJlYWRPYmplY3QoKTsKCiAgICAgICAgLy8gQ2hlY2sgaW52YXJpYW50cyBvdmVyIGNvdW50IGFuZCBpbmRleCBmaWVsZHMuIE5vdGUgdGhhdAogICAgICAgIC8vIGlmIHB1dEluZGV4PT10YWtlSW5kZXgsIGNvdW50IGNhbiBiZSBlaXRoZXIgMCBvciBpdGVtcy5sZW5ndGguCiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PSAwIHx8CiAgICAgICAgICAgICAgICB0YWtlSW5kZXggPCAwIHx8IHRha2VJbmRleCA+PSBpdGVtcy5sZW5ndGggfHwKICAgICAgICAgICAgICAgIHB1dEluZGV4ICA8IDAgfHwgcHV0SW5kZXggID49IGl0ZW1zLmxlbmd0aCB8fAogICAgICAgICAgICAgICAgY291bnQgPCAwICAgICB8fCBjb3VudCAgICAgPiAgaXRlbXMubGVuZ3RoIHx8CiAgICAgICAgICAgICAgICBNYXRoLmZsb29yTW9kKHB1dEluZGV4IC0gdGFrZUluZGV4LCBpdGVtcy5sZW5ndGgpICE9CiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3JNb2QoY291bnQsIGl0ZW1zLmxlbmd0aCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IGphdmEuaW8uSW52YWxpZE9iamVjdEV4Y2VwdGlvbigiaW52YXJpYW50cyB2aW9sYXRlZCIpOwogICAgICAgIH0KICAgIH0KfQo=</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">cGFja2FnZSBqYXZhLnV0aWwuY29uY3VycmVudDsK</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">cHVibGljIGNsYXNzIEFycmF5QmxvY2tpbmdRdWV1ZSB7Cgp9Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICBqYXZhLnV0aWwuZnVuY3Rpb24uCg==</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgICAgICAgQ2FsbGFiCg==</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgICAgICBPcHRpb25hbC5mcm9tSmF2YVV0aWwoKQo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICAgICBqYXZhLnV0aWwuT3B0aW9uYWwuZW0K</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgICAgICBPcHRpb25hbC5hYgo=</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgICAgICBpbnRlZ2VyT3B0aW9uYWwuZnIK</text>
      </register>
    </registers>
    <search>
      <last-search>countr</last-search>
      <last-offset />
      <last-pattern>countr</last-pattern>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>version</entry>
        <entry>war</entry>
        <entry>ju</entry>
        <entry>jui</entry>
        <entry>array</entry>
        <entry>Array</entry>
        <entry>matri</entry>
        <entry>Sol</entry>
        <entry>done</entry>
        <entry>while</entry>
        <entry>await</entry>
        <entry>iml</entry>
        <entry>misc</entry>
        <entry>plugin</entry>
        <entry>plug</entry>
        <entry>jar</entry>
        <entry>retrofit</entry>
        <entry>debug</entry>
        <entry>conne</entry>
        <entry>countr</entry>
      </history-search>
      <history-cmd />
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed E</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>